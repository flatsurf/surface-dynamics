

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>surface_dynamics.databases.flat_surfaces &mdash; surface-dynamics 0.4.7 documentation</title>
  

  
  <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
        <script src="../../../_static/jquery.js"></script>
        <script src="../../../_static/underscore.js"></script>
        <script src="../../../_static/doctools.js"></script>
    
    <script type="text/javascript" src="../../../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../../index.html" class="icon icon-home"> surface-dynamics
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../demo_interval_exchanges.html">Interval exchange transformations</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../strata.html">Strata of Abelian and quadratic differentials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../surface_topology.html">Surface topology and geometry</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../origamis.html">Origamis</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../interval_exchanges/index.html">Interval exchange transformations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../database.html">Database of cylinder diagrams and quadratic permutations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../topological_recursion/index.html">Topological recursion</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../misc/index.html">Miscellaneous</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../references.html">References</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">surface-dynamics</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../../index.html">Module code</a> &raquo;</li>
        
      <li>surface_dynamics.databases.flat_surfaces</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for surface_dynamics.databases.flat_surfaces</h1><div class="highlight"><pre>
<span></span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Databases for translation surfaces.</span>

<span class="sd">This file contain different databases (with different implementations) for</span>
<span class="sd">algorithms related to translation surfaces:</span>

<span class="sd">- structure of Strebel differentials for quadratic differentials in order to</span>
<span class="sd">  differentiate</span>
<span class="sd">- database of separatrix and cylinder diagrams up to isomorphism</span>
<span class="sd">- database of volume of connected components of Abelian strata</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="c1">#*****************************************************************************</span>
<span class="c1">#       Copyright (C) 2009 Vincent Delecroix &lt;20100.delecroix@gmail.com&gt;</span>
<span class="c1">#</span>
<span class="c1">#  Distributed under the terms of the GNU General Public License (GPL)</span>
<span class="c1">#  as published by the Free Software Foundation; either version 2 of</span>
<span class="c1">#  the License, or (at your option) any later version.</span>
<span class="c1">#                  https://www.gnu.org/licenses/</span>
<span class="c1">#*****************************************************************************</span>

<span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">print_function</span><span class="p">,</span> <span class="n">absolute_import</span>

<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">sage.misc.misc</span>

<span class="kn">from</span> <span class="nn">sage.env</span> <span class="kn">import</span> <span class="n">SAGE_SHARE</span>

<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">__path__</span> <span class="k">as</span> <span class="n">db_path</span>
<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">db_path</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
    <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;problem with setting paths&quot;</span><span class="p">)</span>
<span class="n">db_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">db_path</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

<div class="viewcode-block" id="line_count"><a class="viewcode-back" href="../../../database.html#surface_dynamics.databases.flat_surfaces.line_count">[docs]</a><span class="k">def</span> <span class="nf">line_count</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns the number of lines in the file whose name is filename.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">from</span> <span class="nn">sage.rings.integer</span> <span class="kn">import</span> <span class="n">Integer</span>
    <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
    <span class="n">lines</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">read_f</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span> <span class="c1"># loop optimization</span>

    <span class="n">buf</span> <span class="o">=</span> <span class="n">read_f</span><span class="p">(</span><span class="mh">0X100000</span><span class="p">)</span>
    <span class="k">while</span> <span class="n">buf</span><span class="p">:</span>
        <span class="n">lines</span> <span class="o">+=</span> <span class="n">buf</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">buf</span> <span class="o">=</span> <span class="n">read_f</span><span class="p">(</span><span class="mh">0X100000</span><span class="p">)</span>  <span class="c1"># 1024 x 1024</span>

    <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">Integer</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span></div>

<div class="viewcode-block" id="GenericRepertoryDatabase"><a class="viewcode-back" href="../../../database.html#surface_dynamics.databases.flat_surfaces.GenericRepertoryDatabase">[docs]</a><span class="k">class</span> <span class="nc">GenericRepertoryDatabase</span><span class="p">:</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Database that consists of a list of files in a repertory.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">default_name</span> <span class="o">=</span> <span class="s2">&quot;generic_db&quot;</span>
    <span class="n">default_path</span> <span class="o">=</span> <span class="n">sage</span><span class="o">.</span><span class="n">misc</span><span class="o">.</span><span class="n">misc</span><span class="o">.</span><span class="n">SAGE_TMP</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">read_only</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        INPUT:</span>

<span class="sd">        - ``path`` - string (default is SAGE_TMP) - path to the database. If the</span>
<span class="sd">          repertory does not exists, it is created.</span>

<span class="sd">        -  ``name`` - string (default is &#39;generic_db&#39;) - name of the repertory</span>
<span class="sd">           that will contain files of the database.</span>

<span class="sd">        - ``read_only`` - boolean</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">path</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">default_path</span>

        <span class="k">if</span> <span class="n">name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">default_name</span>

        <span class="n">full_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span><span class="n">name</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">full_path</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">read_only</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;you must set read_only to `False` if the database does not already exist&quot;</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">full_path</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">OSError</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;not able to create the database at </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">full_path</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">full_path</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">read_only</span> <span class="o">=</span> <span class="n">read_only</span>

    <span class="k">def</span> <span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        TESTS::</span>

<span class="sd">            sage: from surface_dynamics.databases.flat_surfaces import CylinderDiagrams</span>
<span class="sd">            sage: import os</span>

<span class="sd">            sage: rep1 = os.path.join(tmp_dir())</span>
<span class="sd">            sage: rep2 = os.path.join(tmp_dir())</span>

<span class="sd">            sage: C1 = CylinderDiagrams(rep1,read_only=False)</span>
<span class="sd">            sage: C2 = CylinderDiagrams(rep1,read_only=False)</span>
<span class="sd">            sage: C3 = CylinderDiagrams(rep2,read_only=False)</span>
<span class="sd">            sage: C1 == C1</span>
<span class="sd">            True</span>
<span class="sd">            sage: C1 == C2</span>
<span class="sd">            True</span>
<span class="sd">            sage: C1 == C3</span>
<span class="sd">            False</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span> <span class="ow">is</span> <span class="n">other</span><span class="o">.</span><span class="vm">__class__</span> <span class="ow">and</span> <span class="n">other</span><span class="o">.</span><span class="n">path</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">path</span>

    <span class="k">def</span> <span class="fm">__ne__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        TESTS::</span>

<span class="sd">            sage: from surface_dynamics.databases.flat_surfaces import CylinderDiagrams</span>
<span class="sd">            sage: import os</span>

<span class="sd">            sage: rep1 = os.path.join(tmp_dir())</span>
<span class="sd">            sage: rep2 = os.path.join(tmp_dir())</span>


<span class="sd">            sage: C1 = CylinderDiagrams(rep1,read_only=False)</span>
<span class="sd">            sage: C2 = CylinderDiagrams(rep1,read_only=False)</span>
<span class="sd">            sage: C3 = CylinderDiagrams(rep2,read_only=False)</span>
<span class="sd">            sage: C1 != C1</span>
<span class="sd">            False</span>
<span class="sd">            sage: C1 != C2</span>
<span class="sd">            False</span>
<span class="sd">            sage: C1 != C3</span>
<span class="sd">            True</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="fm">__eq__</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>

<div class="viewcode-block" id="GenericRepertoryDatabase.clean"><a class="viewcode-back" href="../../../database.html#surface_dynamics.databases.flat_surfaces.GenericRepertoryDatabase.clean">[docs]</a>    <span class="k">def</span> <span class="nf">clean</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Clean the database.</span>

<span class="sd">        EXAMPLES::</span>

<span class="sd">            sage: from surface_dynamics import *</span>
<span class="sd">            sage: from surface_dynamics.databases.flat_surfaces import CylinderDiagrams</span>

<span class="sd">            sage: C = CylinderDiagrams(tmp_dir(), &quot;cylinder_diagrams&quot;, read_only=False)</span>
<span class="sd">            sage: C.update(AbelianStratum(4))</span>
<span class="sd">            sage: import os</span>
<span class="sd">            sage: sorted(os.listdir(C.path))</span>
<span class="sd">            [&#39;cyl_diags-4-hyp-1&#39;,</span>
<span class="sd">             &#39;cyl_diags-4-hyp-2&#39;,</span>
<span class="sd">             &#39;cyl_diags-4-hyp-3&#39;,</span>
<span class="sd">             &#39;cyl_diags-4-odd-1&#39;,</span>
<span class="sd">             &#39;cyl_diags-4-odd-2&#39;,</span>
<span class="sd">             &#39;cyl_diags-4-odd-3&#39;]</span>
<span class="sd">            sage: C.clean()</span>
<span class="sd">            sage: os.listdir(C.path)</span>
<span class="sd">            []</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_only</span>
        <span class="k">for</span> <span class="n">filename</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">):</span>
            <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">,</span><span class="n">filename</span><span class="p">))</span></div></div>

<div class="viewcode-block" id="IrregularComponentTwins"><a class="viewcode-back" href="../../../database.html#surface_dynamics.databases.flat_surfaces.IrregularComponentTwins">[docs]</a><span class="k">class</span> <span class="nc">IrregularComponentTwins</span><span class="p">(</span><span class="n">GenericRepertoryDatabase</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Twin data of generalized permutation of irregular components of strata of</span>
<span class="sd">    Abelian differentials.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">default_name</span> <span class="o">=</span> <span class="s2">&quot;generalized_permutation_twins&quot;</span>
    <span class="n">default_path</span> <span class="o">=</span> <span class="n">db_path</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        String representation</span>

<span class="sd">        TESTS::</span>

<span class="sd">            sage: from surface_dynamics.databases.flat_surfaces import IrregularComponentTwins</span>
<span class="sd">            sage: D = IrregularComponentTwins()</span>
<span class="sd">            sage: D.__repr__()</span>
<span class="sd">            &#39;Database of twins of irregular components at ...&#39;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="s2">&quot;Database of twins of irregular components at </span><span class="si">%s</span><span class="s2">&quot;</span><span class="o">%</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span>

<div class="viewcode-block" id="IrregularComponentTwins.filename"><a class="viewcode-back" href="../../../database.html#surface_dynamics.databases.flat_surfaces.IrregularComponentTwins.filename">[docs]</a>    <span class="k">def</span> <span class="nf">filename</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stratum</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the name of the file for the given component.</span>

<span class="sd">        EXAMPLES::</span>

<span class="sd">            sage: from surface_dynamics import *</span>

<span class="sd">            sage: from surface_dynamics.databases.flat_surfaces import IrregularComponentTwins</span>
<span class="sd">            sage: D = IrregularComponentTwins()</span>
<span class="sd">            sage: D.filename(QuadraticStratum(12))</span>
<span class="sd">            &#39;twins-12-irr&#39;</span>
<span class="sd">            sage: D.filename(QuadraticStratum(2,2))</span>
<span class="sd">            Traceback (most recent call last):</span>
<span class="sd">            ...</span>
<span class="sd">            AssertionError: the stratum has no irregular component</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">surface_dynamics.flat_surfaces.quadratic_strata</span> <span class="kn">import</span> <span class="n">QuadraticStratum</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">stratum</span><span class="p">,</span> <span class="n">QuadraticStratum</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">stratum</span><span class="o">.</span><span class="n">has_regular_and_irregular_components</span><span class="p">(),</span> <span class="s2">&quot;the stratum has no irregular component&quot;</span>
        <span class="k">return</span> <span class="p">(</span><span class="s1">&#39;twins-&#39;</span> <span class="o">+</span>
                <span class="s1">&#39;_&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">z</span><span class="p">)</span> <span class="k">for</span> <span class="n">z</span> <span class="ow">in</span> <span class="n">stratum</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">poles</span><span class="o">=</span><span class="kc">False</span><span class="p">))</span> <span class="o">+</span>
                <span class="s1">&#39;_p&#39;</span> <span class="o">*</span> <span class="n">stratum</span><span class="o">.</span><span class="n">nb_poles</span><span class="p">()</span> <span class="o">+</span>
                <span class="s1">&#39;-irr&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="IrregularComponentTwins.has_stratum"><a class="viewcode-back" href="../../../database.html#surface_dynamics.databases.flat_surfaces.IrregularComponentTwins.has_stratum">[docs]</a>    <span class="k">def</span> <span class="nf">has_stratum</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stratum</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Test whether the component is in the database.</span>

<span class="sd">        EXAMPLES::</span>

<span class="sd">            sage: from surface_dynamics import *</span>

<span class="sd">            sage: from surface_dynamics.databases.flat_surfaces import IrregularComponentTwins</span>
<span class="sd">            sage: D = IrregularComponentTwins()</span>
<span class="sd">            sage: D.has_stratum(QuadraticStratum(12))</span>
<span class="sd">            True</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">(</span><span class="n">stratum</span><span class="p">)))</span></div>

<div class="viewcode-block" id="IrregularComponentTwins.update"><a class="viewcode-back" href="../../../database.html#surface_dynamics.databases.flat_surfaces.IrregularComponentTwins.update">[docs]</a>    <span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stratum</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Update the database with the irregular component of the given stratum.</span>

<span class="sd">        The database should not be in read only mode.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_only</span>

        <span class="kn">from</span> <span class="nn">surface_dynamics.interval_exchanges.template</span> <span class="kn">import</span> <span class="n">cylindric_canonical</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">stratum</span><span class="o">.</span><span class="n">irregular_component</span><span class="p">()</span><span class="o">.</span><span class="n">permutation_representative</span><span class="p">()</span>
        <span class="n">res</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">q</span> <span class="ow">in</span> <span class="n">p</span><span class="o">.</span><span class="n">rauzy_diagram</span><span class="p">(</span><span class="n">symmetric</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">q</span><span class="o">.</span><span class="n">is_cylindric</span><span class="p">():</span>
                <span class="n">res</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">cylindric_canonical</span><span class="p">(</span><span class="n">q</span><span class="p">))</span>
        <span class="n">res</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>

        <span class="n">filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">(</span><span class="n">stratum</span><span class="p">))</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">output</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">can</span> <span class="ow">in</span> <span class="n">res</span><span class="p">:</span>
                <span class="n">output</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">can</span><span class="p">))</span>
                <span class="n">output</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="IrregularComponentTwins.list_strata"><a class="viewcode-back" href="../../../database.html#surface_dynamics.databases.flat_surfaces.IrregularComponentTwins.list_strata">[docs]</a>    <span class="k">def</span> <span class="nf">list_strata</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the list of components for which the list of twins is stored.</span>

<span class="sd">        EXAMPLES::</span>

<span class="sd">            sage: from surface_dynamics.databases.flat_surfaces import IrregularComponentTwins</span>
<span class="sd">            sage: G = IrregularComponentTwins()</span>
<span class="sd">            sage: G.list_strata()</span>
<span class="sd">            [Q_3(9, -1), Q_3(6, 3, -1), Q_4(12), Q_3(3^3, -1), Q_4(6^2), Q_4(9, 3), Q_4(6, 3^2), Q_4(3^4)]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">surface_dynamics.flat_surfaces.quadratic_strata</span> <span class="kn">import</span> <span class="n">QuadraticStratum</span>
        <span class="kn">from</span> <span class="nn">sage.rings.integer</span> <span class="kn">import</span> <span class="n">Integer</span>
        <span class="n">s</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">f</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;twins-&#39;</span><span class="p">):</span>
                <span class="n">g</span> <span class="o">=</span> <span class="n">f</span><span class="p">[</span><span class="mi">6</span><span class="p">:]</span>
                <span class="n">i</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)</span>
                <span class="n">comp</span> <span class="o">=</span> <span class="n">g</span><span class="p">[:</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;p&#39;</span><span class="p">,</span><span class="s1">&#39;-1&#39;</span><span class="p">)</span>
                <span class="n">s</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">comp</span><span class="p">)</span>

        <span class="k">return</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">QuadraticStratum</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span><span class="n">g</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)))</span> <span class="k">for</span> <span class="n">g</span> <span class="ow">in</span> <span class="n">s</span><span class="p">)</span></div>

<div class="viewcode-block" id="IrregularComponentTwins.get"><a class="viewcode-back" href="../../../database.html#surface_dynamics.databases.flat_surfaces.IrregularComponentTwins.get">[docs]</a>    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stratum</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the list of twins for the stratum of quadratic differentials ``stratum``.</span>

<span class="sd">        EXAMPLES::</span>

<span class="sd">            sage: from surface_dynamics import *</span>

<span class="sd">            sage: from surface_dynamics.databases.flat_surfaces import IrregularComponentTwins</span>
<span class="sd">            sage: D = IrregularComponentTwins()</span>
<span class="sd">            sage: l = D.get(QuadraticStratum(6,3,-1))</span>
<span class="sd">            sage: l[0]</span>
<span class="sd">            ((1, 2, 0, 4, 6, 7, 8, 9, 10, 11, 12, 13, 5, 3),)</span>
<span class="sd">            sage: len(l)</span>
<span class="sd">            32</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_stratum</span><span class="p">(</span><span class="n">stratum</span><span class="p">)</span>
        <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">(</span><span class="n">stratum</span><span class="p">)))</span>

        <span class="n">res</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
        <span class="k">while</span> <span class="n">s</span><span class="p">:</span>
            <span class="n">res</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">eval</span><span class="p">(</span><span class="n">s</span><span class="p">))</span>
            <span class="n">s</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">res</span></div>

<div class="viewcode-block" id="IrregularComponentTwins.count"><a class="viewcode-back" href="../../../database.html#surface_dynamics.databases.flat_surfaces.IrregularComponentTwins.count">[docs]</a>    <span class="k">def</span> <span class="nf">count</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stratum</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the number of twins for that stratum.</span>

<span class="sd">        EXAMPLES::</span>

<span class="sd">            sage: from surface_dynamics import *</span>

<span class="sd">            sage: from surface_dynamics.databases.flat_surfaces import IrregularComponentTwins</span>
<span class="sd">            sage: D = IrregularComponentTwins()</span>
<span class="sd">            sage: Q = QuadraticStratum(12)</span>
<span class="sd">            sage: len(D.get(Q))</span>
<span class="sd">            82</span>
<span class="sd">            sage: D.count(Q)</span>
<span class="sd">            82</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">line_count</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">(</span><span class="n">stratum</span><span class="p">)))</span></div></div>

<div class="viewcode-block" id="CylinderDiagrams"><a class="viewcode-back" href="../../../database.html#surface_dynamics.databases.flat_surfaces.CylinderDiagrams">[docs]</a><span class="k">class</span> <span class="nc">CylinderDiagrams</span><span class="p">(</span><span class="n">GenericRepertoryDatabase</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Database of cylinder diagrams.</span>

<span class="sd">    The database consists of several files with the following name convention:</span>
<span class="sd">    &quot;stratum-component-ncyls&quot;. As an example, the list of 3-cylinder diagrams in</span>
<span class="sd">    the odd component of H(2,2) is named &quot;2_2-odd-3&quot;.</span>

<span class="sd">    EXAMPLES::</span>

<span class="sd">        sage: from surface_dynamics import *</span>
<span class="sd">        sage: from surface_dynamics.databases.flat_surfaces import CylinderDiagrams</span>
<span class="sd">        sage: import os</span>
<span class="sd">        sage: C = CylinderDiagrams()</span>
<span class="sd">        sage: a = AbelianStratum(3,1,1,1).unique_component()</span>
<span class="sd">        sage: C.filename(a, 2)</span>
<span class="sd">        &#39;cyl_diags-3_1_1_1-c-2&#39;</span>
<span class="sd">        sage: os.path.isfile(os.path.join(C.path, C.filename(a, 2)))</span>
<span class="sd">        True</span>
<span class="sd">        sage: l = list(C.get_iterator(a, 2))</span>
<span class="sd">        sage: l[0]</span>
<span class="sd">        (0,9)-(0,5,7,8,6) (1,6,2,5,3,8,4,7)-(1,2,3,9,4)</span>
<span class="sd">        sage: l[0].ncyls()</span>
<span class="sd">        2</span>
<span class="sd">        sage: l[0].stratum()</span>
<span class="sd">        H_4(3, 1^3)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">default_name</span> <span class="o">=</span> <span class="s2">&quot;cylinder_diagrams&quot;</span>
    <span class="n">default_path</span> <span class="o">=</span> <span class="n">db_path</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        String representation.</span>

<span class="sd">        TEST::</span>

<span class="sd">            sage: from surface_dynamics.databases.flat_surfaces import CylinderDiagrams</span>
<span class="sd">            sage: C = CylinderDiagrams(tmp_dir(), read_only=False)</span>
<span class="sd">            sage: C    # indirect doctest</span>
<span class="sd">            Database of cylinder diagrams at ...</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="s2">&quot;Database of cylinder diagrams at </span><span class="si">%s</span><span class="s2">&quot;</span><span class="o">%</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span>

<div class="viewcode-block" id="CylinderDiagrams.filename"><a class="viewcode-back" href="../../../database.html#surface_dynamics.databases.flat_surfaces.CylinderDiagrams.filename">[docs]</a>    <span class="k">def</span> <span class="nf">filename</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">comp</span><span class="p">,</span> <span class="n">ncyls</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the name of the file for the given component ``comp`` and the</span>
<span class="sd">        given of number of cylinders ``ncyls``.</span>

<span class="sd">        EXAMPLES::</span>

<span class="sd">            sage: from surface_dynamics import *</span>
<span class="sd">            sage: from surface_dynamics.databases.flat_surfaces import CylinderDiagrams</span>
<span class="sd">            sage: C = CylinderDiagrams()</span>
<span class="sd">            sage: C.filename(AbelianStratum(4).odd_component(), 3)</span>
<span class="sd">            &#39;cyl_diags-4-odd-3&#39;</span>
<span class="sd">            sage: C.filename(AbelianStratum(3,3).hyperelliptic_component(), 2)</span>
<span class="sd">            &#39;cyl_diags-3_3-hyp-2&#39;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">(</span><span class="s1">&#39;cyl_diags-&#39;</span> <span class="o">+</span>
                <span class="s1">&#39;_&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">z</span><span class="p">)</span> <span class="k">for</span> <span class="n">z</span> <span class="ow">in</span> <span class="n">comp</span><span class="o">.</span><span class="n">stratum</span><span class="p">()</span><span class="o">.</span><span class="n">zeros</span><span class="p">())</span> <span class="o">+</span>
                <span class="s1">&#39;-&#39;</span> <span class="o">+</span> <span class="n">comp</span><span class="o">.</span><span class="n">_name</span> <span class="o">+</span>
                <span class="s1">&#39;-&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">ncyls</span><span class="p">))</span></div>

<div class="viewcode-block" id="CylinderDiagrams.has_component"><a class="viewcode-back" href="../../../database.html#surface_dynamics.databases.flat_surfaces.CylinderDiagrams.has_component">[docs]</a>    <span class="k">def</span> <span class="nf">has_component</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">comp</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Test whether the database has the component ``comp``.</span>

<span class="sd">        EXAMPLES::</span>

<span class="sd">            sage: from surface_dynamics import *</span>

<span class="sd">            sage: from surface_dynamics.databases.flat_surfaces import CylinderDiagrams</span>
<span class="sd">            sage: import os</span>

<span class="sd">            sage: C = CylinderDiagrams(tmp_dir(), read_only=False)</span>
<span class="sd">            sage: C.clean()</span>

<span class="sd">            sage: a1 = AbelianStratum(4).odd_component()</span>
<span class="sd">            sage: a2 = AbelianStratum(1,1,1,1).unique_component()</span>

<span class="sd">            sage: C.has_component(a1)</span>
<span class="sd">            False</span>
<span class="sd">            sage: C.has_component(a2)</span>
<span class="sd">            False</span>
<span class="sd">            sage: C.update(AbelianStratum(4))</span>
<span class="sd">            sage: C.has_component(a1)</span>
<span class="sd">            True</span>

<span class="sd">            sage: C.has_component(a2)</span>
<span class="sd">            False</span>

<span class="sd">            sage: C.has_component(-19)</span>
<span class="sd">            Traceback (most recent call last):</span>
<span class="sd">            ...</span>
<span class="sd">            AssertionError: the argument must be a component of stratum of Abelian differentials</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">surface_dynamics.flat_surfaces.abelian_strata</span> <span class="kn">import</span> <span class="n">AbelianStratumComponent</span>

        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">comp</span><span class="p">,</span> <span class="n">AbelianStratumComponent</span><span class="p">),</span> <span class="s2">&quot;the argument must be a component of stratum of Abelian differentials&quot;</span>
        <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">(</span><span class="n">comp</span><span class="p">,</span> <span class="mi">1</span><span class="p">)))</span></div>

<div class="viewcode-block" id="CylinderDiagrams.has_stratum"><a class="viewcode-back" href="../../../database.html#surface_dynamics.databases.flat_surfaces.CylinderDiagrams.has_stratum">[docs]</a>    <span class="k">def</span> <span class="nf">has_stratum</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stratum</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Test whether the database contains the data for a given stratum.</span>

<span class="sd">        EXAMPLES::</span>

<span class="sd">            sage: from surface_dynamics import *</span>

<span class="sd">            sage: from surface_dynamics.databases.flat_surfaces import CylinderDiagrams</span>
<span class="sd">            sage: import os</span>

<span class="sd">            sage: C = CylinderDiagrams(tmp_dir(), read_only=False)</span>
<span class="sd">            sage: C.clean()</span>

<span class="sd">            sage: a1 = AbelianStratum(4)</span>
<span class="sd">            sage: a2 = AbelianStratum(1,1,1,1)</span>

<span class="sd">            sage: C.has_stratum(a1)</span>
<span class="sd">            False</span>
<span class="sd">            sage: C.has_stratum(a2)</span>
<span class="sd">            False</span>
<span class="sd">            sage: C.update(AbelianStratum(4))</span>
<span class="sd">            sage: C.has_stratum(a1)</span>
<span class="sd">            True</span>

<span class="sd">            sage: C.has_stratum(a2)</span>
<span class="sd">            False</span>

<span class="sd">            sage: C.has_stratum(1)</span>
<span class="sd">            Traceback (most recent call last):</span>
<span class="sd">            ...</span>
<span class="sd">            AssertionError: the argument must be a stratum of Abelian differential</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">surface_dynamics.flat_surfaces.abelian_strata</span> <span class="kn">import</span> <span class="n">AbelianStratum</span>

        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">stratum</span><span class="p">,</span> <span class="n">AbelianStratum</span><span class="p">),</span> <span class="s2">&quot;the argument must be a stratum of Abelian differential&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_component</span><span class="p">(</span><span class="n">stratum</span><span class="o">.</span><span class="n">one_component</span><span class="p">())</span></div>

    <span class="k">def</span> <span class="nf">_files</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Iterator over the list of files.</span>

<span class="sd">        TESTS::</span>

<span class="sd">            sage: from surface_dynamics.databases.flat_surfaces import CylinderDiagrams</span>
<span class="sd">            sage: C = CylinderDiagrams()</span>
<span class="sd">            sage: C._files()</span>
<span class="sd">            &lt;generator object ...&gt;</span>
<span class="sd">            sage: it = C._files()</span>
<span class="sd">            sage: next(it)  # random</span>
<span class="sd">            &#39;cyl_diags-...&#39;</span>
<span class="sd">            sage: next(it)  # random</span>
<span class="sd">            &#39;cyl_diags-...&#39;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">f</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;cyl_diags-&#39;</span><span class="p">):</span>
                <span class="k">yield</span> <span class="n">f</span>

<div class="viewcode-block" id="CylinderDiagrams.list_strata"><a class="viewcode-back" href="../../../database.html#surface_dynamics.databases.flat_surfaces.CylinderDiagrams.list_strata">[docs]</a>    <span class="k">def</span> <span class="nf">list_strata</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        List available strata in that database.</span>

<span class="sd">        EXAMPLES::</span>

<span class="sd">            sage: from surface_dynamics import *</span>

<span class="sd">            sage: from surface_dynamics.databases.flat_surfaces import CylinderDiagrams</span>
<span class="sd">            sage: import os</span>

<span class="sd">            sage: C = CylinderDiagrams(tmp_dir(), read_only=False)</span>
<span class="sd">            sage: C.clean()</span>

<span class="sd">            sage: C.list_strata()</span>
<span class="sd">            []</span>
<span class="sd">            sage: C.update(AbelianStratum(1,1))</span>
<span class="sd">            sage: C.list_strata()</span>
<span class="sd">            [H_2(1^2)]</span>
<span class="sd">            sage: C.update(AbelianStratum(2))</span>
<span class="sd">            sage: C.list_strata()</span>
<span class="sd">            [H_2(2), H_2(1^2)]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">surface_dynamics.flat_surfaces.abelian_strata</span> <span class="kn">import</span> <span class="n">AbelianStratum</span>
        <span class="kn">from</span> <span class="nn">sage.rings.integer</span> <span class="kn">import</span> <span class="n">Integer</span>
        <span class="n">s</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_files</span><span class="p">():</span>
            <span class="n">g</span> <span class="o">=</span> <span class="n">f</span><span class="p">[</span><span class="mi">10</span><span class="p">:]</span>
            <span class="n">s</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">g</span><span class="p">[:</span><span class="n">g</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)])</span>

        <span class="k">return</span> <span class="p">[</span><span class="n">AbelianStratum</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">g</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)))</span> <span class="k">for</span> <span class="n">g</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)]</span></div>

<div class="viewcode-block" id="CylinderDiagrams.get_iterator"><a class="viewcode-back" href="../../../database.html#surface_dynamics.databases.flat_surfaces.CylinderDiagrams.get_iterator">[docs]</a>    <span class="k">def</span> <span class="nf">get_iterator</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">comp</span><span class="p">,</span> <span class="n">ncyls</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns an iterator over the list of cylinder diagrams for the component</span>
<span class="sd">        ``comp`` read from the database.</span>

<span class="sd">        INPUT:</span>

<span class="sd">        - ``comp`` - a component of stratum</span>

<span class="sd">        - ``ncyls`` - number of cylinders</span>

<span class="sd">        EXAMPLES::</span>

<span class="sd">            sage: from surface_dynamics import *</span>

<span class="sd">            sage: from surface_dynamics.databases.flat_surfaces import CylinderDiagrams</span>
<span class="sd">            sage: import os</span>

<span class="sd">            sage: C = CylinderDiagrams(tmp_dir(), read_only=False)</span>

<span class="sd">            sage: A = AbelianStratum(2)</span>
<span class="sd">            sage: a = A.unique_component()</span>
<span class="sd">            sage: C.update(A)</span>
<span class="sd">            sage: list(C.get_iterator(a)) == A.cylinder_diagrams()</span>
<span class="sd">            True</span>

<span class="sd">            sage: C.clean()</span>
<span class="sd">            sage: C.get_iterator(a)</span>
<span class="sd">            Traceback (most recent call last):</span>
<span class="sd">            ...</span>
<span class="sd">            ValueError: not in the database</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">surface_dynamics.flat_surfaces.strata</span> <span class="kn">import</span> <span class="n">Stratum</span><span class="p">,</span> <span class="n">StratumComponent</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">comp</span><span class="p">,</span> <span class="n">StratumComponent</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;comp should be a component of stratum&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">ncyls</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="kn">from</span> <span class="nn">itertools</span> <span class="kn">import</span> <span class="n">chain</span>
            <span class="n">g</span> <span class="o">=</span> <span class="n">comp</span><span class="o">.</span><span class="n">stratum</span><span class="p">()</span><span class="o">.</span><span class="n">genus</span><span class="p">()</span>
            <span class="n">s</span> <span class="o">=</span> <span class="n">comp</span><span class="o">.</span><span class="n">stratum</span><span class="p">()</span><span class="o">.</span><span class="n">nb_zeros</span><span class="p">()</span>
            <span class="k">return</span> <span class="n">chain</span><span class="p">(</span><span class="o">*</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_iterator</span><span class="p">(</span><span class="n">comp</span><span class="p">,</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">g</span><span class="o">+</span><span class="n">s</span><span class="p">)))</span>

        <span class="n">filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">(</span><span class="n">comp</span><span class="p">,</span><span class="n">ncyls</span><span class="p">))</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;not in the database&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_one_file_iterator</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">_one_file_iterator</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
        <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
        <span class="kn">from</span> <span class="nn">surface_dynamics.flat_surfaces.separatrix_diagram</span> <span class="kn">import</span> <span class="n">CylinderDiagram</span>
        <span class="n">line</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
        <span class="k">while</span> <span class="n">line</span><span class="p">:</span>
            <span class="k">yield</span> <span class="n">CylinderDiagram</span><span class="p">(</span><span class="n">line</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">line</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
        <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_check_symmetries</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        TESTS::</span>

<span class="sd">            sage: from surface_dynamics.databases.flat_surfaces import CylinderDiagrams</span>
<span class="sd">            sage: C = CylinderDiagrams()</span>
<span class="sd">            sage: C._check_symmetries(&#39;cyl_diags-4_2-odd-5&#39;)   # not tested -- to be fixed</span>
<span class="sd">            sage: for filename in C._files():          # not tested -- very long time, ~1h</span>
<span class="sd">            ....:     C._check_symmetries(filename)    # not tested -- very long time, ~1h</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_one_file_iterator</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">c</span> <span class="o">!=</span> <span class="n">c</span><span class="o">.</span><span class="n">canonical_label</span><span class="p">(</span><span class="n">inplace</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;in file </span><span class="si">{}</span><span class="s2">, </span><span class="si">{}</span><span class="s2"> does not have canonical labels&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">filename</span><span class="p">,</span> <span class="n">c</span><span class="p">))</span>
            <span class="n">c1</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">horizontal_symmetry</span><span class="p">()</span>
            <span class="n">c1</span><span class="o">.</span><span class="n">canonical_label</span><span class="p">(</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">c1</span> <span class="o">&lt;</span> <span class="n">c</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;in file </span><span class="si">{}</span><span class="s2">, </span><span class="si">{}</span><span class="s2"> is not minimal... </span><span class="si">{}</span><span class="s2"> is the good one!&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">filename</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span><span class="n">c1</span><span class="p">))</span>
            <span class="n">c1</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">vertical_symmetry</span><span class="p">()</span>
            <span class="n">c1</span><span class="o">.</span><span class="n">canonical_label</span><span class="p">(</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">c1</span> <span class="o">&lt;</span> <span class="n">c</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;in file </span><span class="si">{}</span><span class="s2">, </span><span class="si">{}</span><span class="s2"> is not minimal... </span><span class="si">{}</span><span class="s2"> is the good one!&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">filename</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span><span class="n">c1</span><span class="p">))</span>
            <span class="n">c1</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">inverse</span><span class="p">()</span>
            <span class="n">c1</span><span class="o">.</span><span class="n">canonical_label</span><span class="p">(</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">c1</span> <span class="o">&lt;</span> <span class="n">c</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;in file </span><span class="si">{}</span><span class="s2">, </span><span class="si">{}</span><span class="s2"> is not minimal... </span><span class="si">{}</span><span class="s2"> is the good one!&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">filename</span><span class="p">,</span><span class="n">c</span><span class="p">,</span><span class="n">c1</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_remove_symmetries</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Use this at your own risk! It modifies the file of the database</span>
<span class="sd">        inplace!!!</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>
        <span class="n">n</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">s</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="n">garbage</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_one_file_iterator</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
            <span class="n">n</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">garbage</span><span class="p">:</span>
                <span class="k">continue</span>

            <span class="n">cc</span> <span class="o">=</span> <span class="p">[</span><span class="n">c</span><span class="p">]</span>

            <span class="n">c1</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">horizontal_symmetry</span><span class="p">()</span>
            <span class="n">c1</span><span class="o">.</span><span class="n">canonical_label</span><span class="p">(</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">cc</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">c1</span><span class="p">)</span>

            <span class="n">c1</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">vertical_symmetry</span><span class="p">()</span>
            <span class="n">c1</span><span class="o">.</span><span class="n">canonical_label</span><span class="p">(</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">cc</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">c1</span><span class="p">)</span>

            <span class="n">c1</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">inverse</span><span class="p">()</span>
            <span class="n">c1</span><span class="o">.</span><span class="n">canonical_label</span><span class="p">(</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">cc</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">c1</span><span class="p">)</span>

            <span class="n">s</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">cc</span><span class="p">))</span>
            <span class="n">garbage</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">cc</span><span class="p">)</span>

        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;old cardinality:&quot;</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;new cardinality:&quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">))</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;gain           :&quot;</span><span class="p">,</span> <span class="n">n</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">))</span>

        <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

<div class="viewcode-block" id="CylinderDiagrams.update"><a class="viewcode-back" href="../../../database.html#surface_dynamics.databases.flat_surfaces.CylinderDiagrams.update">[docs]</a>    <span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stratum</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Compute once for all the given cylinder diagrams of the given</span>
<span class="sd">        ``stratum``.</span>

<span class="sd">        Warning::</span>

<span class="sd">            Depending on the dimension of the stratum, it may be very long!</span>

<span class="sd">        EXAMPLES::</span>

<span class="sd">            sage: from surface_dynamics import *</span>

<span class="sd">            sage: from surface_dynamics.databases.flat_surfaces import CylinderDiagrams</span>

<span class="sd">            sage: C = CylinderDiagrams(tmp_dir(), read_only=False)</span>
<span class="sd">            sage: C.update(AbelianStratum(4), verbose=True) # random</span>
<span class="sd">            computation for H_3(4)</span>
<span class="sd">             ncyls = 1</span>
<span class="sd">             1 cyl. diags for H_3(4)^hyp</span>
<span class="sd">             2 cyl. diags for H_3(4)^odd</span>
<span class="sd">             ncyls = 2</span>
<span class="sd">             2 cyl. diags for H_3(4)^hyp</span>
<span class="sd">             4 cyl. diags for H_3(4)^odd</span>
<span class="sd">             ncyls = 3</span>
<span class="sd">             2 cyl. diags for H_3(4)^hyp</span>
<span class="sd">             4 cyl. diags for H_3(4)^odd</span>
<span class="sd">            sage: sorted(os.listdir(C.path))</span>
<span class="sd">            [&#39;cyl_diags-4-hyp-1&#39;,</span>
<span class="sd">             &#39;cyl_diags-4-hyp-2&#39;,</span>
<span class="sd">             &#39;cyl_diags-4-hyp-3&#39;,</span>
<span class="sd">             &#39;cyl_diags-4-odd-1&#39;,</span>
<span class="sd">             &#39;cyl_diags-4-odd-2&#39;,</span>
<span class="sd">             &#39;cyl_diags-4-odd-3&#39;]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">import</span> <span class="nn">sys</span>

        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;computation for </span><span class="si">%s</span><span class="s2">&quot;</span><span class="o">%</span><span class="n">stratum</span><span class="p">)</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">ncyls</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">stratum</span><span class="o">.</span><span class="n">genus</span><span class="p">()</span> <span class="o">+</span> <span class="n">stratum</span><span class="o">.</span><span class="n">nb_zeros</span><span class="p">()):</span>
            <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot; ncyls = </span><span class="si">%d</span><span class="s2">&quot;</span><span class="o">%</span><span class="n">ncyls</span><span class="p">)</span>
                <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
            <span class="n">d</span> <span class="o">=</span> <span class="n">stratum</span><span class="o">.</span><span class="n">cylinder_diagrams_by_component</span><span class="p">(</span><span class="n">ncyls</span><span class="p">,</span> <span class="n">force_computation</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">d</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot; </span><span class="si">%d</span><span class="s2"> cyl. diags for </span><span class="si">%s</span><span class="s2">&quot;</span><span class="o">%</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="n">c</span><span class="p">]),</span><span class="n">c</span><span class="p">))</span>
                <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">(</span><span class="n">c</span><span class="p">,</span><span class="n">ncyls</span><span class="p">)),</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">cyl</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="n">c</span><span class="p">]):</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">cyl</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></div>

<div class="viewcode-block" id="CylinderDiagrams.count"><a class="viewcode-back" href="../../../database.html#surface_dynamics.databases.flat_surfaces.CylinderDiagrams.count">[docs]</a>    <span class="k">def</span> <span class="nf">count</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">comp</span><span class="p">,</span> <span class="n">ncyls</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the number of cylinder diagrams for a stratum or a component of</span>
<span class="sd">        stratum with given number of cylinders.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">surface_dynamics.flat_surfaces.abelian_strata</span> <span class="kn">import</span> <span class="n">AbelianStratum</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">comp</span><span class="p">,</span> <span class="n">AbelianStratum</span><span class="p">):</span>
            <span class="k">return</span> <span class="nb">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="n">cc</span><span class="p">,</span> <span class="n">ncyls</span><span class="p">)</span> <span class="k">for</span> <span class="n">cc</span> <span class="ow">in</span> <span class="n">comp</span><span class="o">.</span><span class="n">components</span><span class="p">())</span>

        <span class="k">if</span> <span class="n">ncyls</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">g</span> <span class="o">=</span> <span class="n">comp</span><span class="o">.</span><span class="n">stratum</span><span class="p">()</span><span class="o">.</span><span class="n">genus</span><span class="p">()</span>
            <span class="n">s</span> <span class="o">=</span> <span class="n">comp</span><span class="o">.</span><span class="n">stratum</span><span class="p">()</span><span class="o">.</span><span class="n">nb_zeros</span><span class="p">()</span>
            <span class="k">return</span> <span class="nb">sum</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="n">comp</span><span class="p">,</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">g</span><span class="o">+</span><span class="n">s</span><span class="p">)))</span>

        <span class="k">return</span> <span class="n">line_count</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">(</span><span class="n">comp</span><span class="p">,</span> <span class="n">ncyls</span><span class="p">)))</span></div></div>
</pre></div>

           </div>
           
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2021, the surface-dynamics authors.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>