<!doctype html>
<html class="no-js" lang="en">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><link rel="index" title="Index" href="../../../../genindex.html" /><link rel="search" title="Search" href="../../../../search.html" />

    <!-- Generated with Sphinx 5.3.0 and Furo 2023.05.20 -->
        <title>surface_dynamics.flat_surfaces.origamis.origami_database - surface-dynamics 0.4.7 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../../../_static/styles/furo.css?digest=e6660623a769aa55fea372102b9bf3151b292993" />
    <link rel="stylesheet" type="text/css" href="../../../../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../../../../_static/styles/furo-extensions.css?digest=30d1aed668e5c3a91c3e3bf6a60b675221979f0e" />
    <link rel="stylesheet" type="text/css" href="https://doc.sagemath.org/html/en/reference/_static/custom-furo.css" />
    
    


<style>
  body {
    --color-code-background: #eeffcc;
  --color-code-foreground: black;
  --color-brand-primary: #0f0fff;
  --color-brand-content: #0f0fff;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #272822;
  --color-code-foreground: #f8f8f2;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #272822;
  --color-code-foreground: #f8f8f2;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-half" viewBox="0 0 24 24">
    <title>Auto light/dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-shadow">
      <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
      <circle cx="12" cy="12" r="9" />
      <path d="M13 12h5" />
      <path d="M13 15h4" />
      <path d="M13 18h1" />
      <path d="M13 9h4" />
      <path d="M13 6h1" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="../../../../index.html"><div class="brand">surface-dynamics 0.4.7 documentation</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon no-toc" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="../../../../index.html">
  
  <div class="sidebar-logo-container">
    <img class="sidebar-logo only-light" src="../../../../_static/logo.svg" alt="Light Logo"/>
    <img class="sidebar-logo only-dark" src="../../../../_static/logo.svg" alt="Dark Logo"/>
  </div>
  
  <span class="sidebar-brand-text">surface-dynamics 0.4.7 documentation</span>
  
</a><form class="sidebar-search-container" method="get" action="../../../../search.html" role="search">
  <input class="sidebar-search" placeholder="Search" name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../examples/interval_exchanges.html">Interval exchange transformations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../examples/square_tiled_surfaces.html">Square-tiled surfaces</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../examples/rank2_genus3_classification.html">Filtering Possible <span class="math notranslate nohighlight">\(\mathcal M\)</span>-Parallel Classes</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../strata.html">Strata of Abelian and quadratic differentials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../surface_topology.html">Surface topology and geometry</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../origamis.html">Origamis</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../../interval_exchanges/index.html">Interval exchange transformations</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" role="switch" type="checkbox"/><label for="toctree-checkbox-1"><div class="visually-hidden">Toggle navigation of Interval exchange transformations</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../../interval_exchanges/constructors.html">Interval exchange constructors</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../interval_exchanges/template.html">Permutation template</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../interval_exchanges/labelled.html">Labelled permutations</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../interval_exchanges/reduced.html">Reduced permutations</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../interval_exchanges/rauzy_class_cardinality.html">Rauzy class cardinality</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../interval_exchanges/cover.html">Covering construction</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../interval_exchanges/iet.html">Interval exchange transformations</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../interval_exchanges/integer_iet.html">Integral interval exchanges</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../interval_exchanges/iet_family.html">Interval exchange families</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../interval_exchanges/flip_sequence.html">Flip sequences</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../../database.html">Database of cylinder diagrams and quadratic permutations</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../../topological_recursion/index.html">Topological recursion</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" role="switch" type="checkbox"/><label for="toctree-checkbox-2"><div class="visually-hidden">Toggle navigation of Topological recursion</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../../topological_recursion/topological_recursion.html">Generic topological recursion</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../topological_recursion/kontsevich.html">Kontsevich topological recursion</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../topological_recursion/masur_veech.html">Masur-Veech topological recursion</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../../misc/index.html">Miscellaneous</a><input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" role="switch" type="checkbox"/><label for="toctree-checkbox-3"><div class="visually-hidden">Toggle navigation of Miscellaneous</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../../misc/constellation.html">Constellations</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../misc/group_representation.html">Finite group representation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../misc/plane_tree.html">Plane trees</a></li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../references.html">References</a></li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          <div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon no-toc" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main">
          <h1>Source code for surface_dynamics.flat_surfaces.origamis.origami_database</h1><div class="highlight"><pre>
<span></span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Database of reduced origamis.</span>

<span class="sd">Origamis are cover of the torus over one point. The group `SL(2,\ZZ)` act on them</span>
<span class="sd">(as their mapping class group). This file contains the implementation of a</span>
<span class="sd">database of these SL(2,Z)-orbits. To do concrete computations with origamis see</span>
<span class="sd">?.</span>

<span class="sd">The database of origamis contain information about `SL(2,\ZZ)` orbits of the</span>
<span class="sd">origamis that are *arithmetic Teichmueller curves*.</span>

<span class="sd">EXAMPLES::</span>

<span class="sd">    sage: from surface_dynamics import *</span>

<span class="sd">The most useful way to explore the database through queries. We develop several</span>
<span class="sd">examples below and refer to the documentation in the method</span>
<span class="sd">:meth:`OrigamiDatabase.query` for the complete specifications.</span>

<span class="sd">Let us start by finding the two exceptional surfaces whose Teichmueller curves</span>
<span class="sd">have a complete degenerate Lyapunov spectrum: the Eierlegende Wollmilchsau and</span>
<span class="sd">the Ornythorinque::</span>

<span class="sd">    sage: D = OrigamiDatabase()</span>

<span class="sd">    sage: q = D.query(sum_of_L_exp=1)</span>
<span class="sd">    sage: q.number_of()</span>
<span class="sd">    2</span>
<span class="sd">    sage: o0, o1 = q.list()</span>
<span class="sd">    sage: o0</span>
<span class="sd">    (1,2,3,4)(5,6,7,8)</span>
<span class="sd">    (1,5,3,7)(2,8,4,6)</span>
<span class="sd">    sage: o1</span>
<span class="sd">    (1,2,3,4,5,6)(7,8,9,10,11,12)</span>
<span class="sd">    (1,7,5,9,3,11)(2,8,4,12,6,10)</span>
<span class="sd">    sage: o0.is_isomorphic(origamis.CyclicCover([1,1,1,1]))</span>
<span class="sd">    True</span>
<span class="sd">    sage: o1.is_isomorphic(origamis.CyclicCover([1,1,1,3]))</span>
<span class="sd">    True</span>

<span class="sd">We show two methods to get information on a given query:</span>
<span class="sd">:meth:`~OrigamiQuery.number_of` and :meth:`~OrigamiQuery.list`. To simply</span>
<span class="sd">display the result on the screen in a table, one can use</span>
<span class="sd">:meth:`~OrigamiQuery.show` of :class:`OrigamiQuery`::</span>

<span class="sd">    sage: q.show()</span>
<span class="sd">    Origami</span>
<span class="sd">    --------------------</span>
<span class="sd">    r=1234 5678  u=1537 2846</span>
<span class="sd">    r=123456 789abc  u=17593b 284c6a</span>

<span class="sd">We can display much more information by modifying the displayed columns::</span>

<span class="sd">    sage: q.cols(&#39;nb_squares&#39;, &#39;stratum&#39;, &#39;component&#39;, &#39;regular&#39;, &#39;quasi_regular&#39;)</span>
<span class="sd">    sage: q.show()</span>
<span class="sd">    Nb squares           Stratum              Comp.                Regular              Quasi regular</span>
<span class="sd">    ----------------------------------------------------------------------------------------------------</span>
<span class="sd">    8                    H_3(1^4)             c                    True                 True</span>
<span class="sd">    12                   H_4(2^3)             even                 False                True</span>

<span class="sd">And the complete list of columns in the database is obtained through::</span>

<span class="sd">    sage: D.cols()</span>
<span class="sd">    [&#39;representative&#39;,</span>
<span class="sd">     &#39;stratum&#39;,</span>
<span class="sd">     &#39;component&#39;,</span>
<span class="sd">     &#39;primitive&#39;,</span>
<span class="sd">     &#39;quasi_primitive&#39;,</span>
<span class="sd">     &#39;orientation_cover&#39;,</span>
<span class="sd">     &#39;hyperelliptic&#39;,</span>
<span class="sd">     &#39;regular&#39;,</span>
<span class="sd">     &#39;quasi_regular&#39;,</span>
<span class="sd">    ...</span>
<span class="sd">     &#39;relative_monodromy_nilpotent&#39;,</span>
<span class="sd">     &#39;relative_monodromy_gap_primitive_id&#39;,</span>
<span class="sd">     &#39;orientation_stratum&#39;,</span>
<span class="sd">     &#39;orientation_genus&#39;,</span>
<span class="sd">     &#39;pole_partition&#39;,</span>
<span class="sd">     &#39;automorphism_group_order&#39;,</span>
<span class="sd">     &#39;automorphism_group_name&#39;]</span>

<span class="sd">Now, we do some simple counting of the number of primitive arithmetic</span>
<span class="sd">Teichmueller curves. Let us first check the classification of arithmetic</span>
<span class="sd">Teichmueller curves in H(2) from Hubert-Lelievre and McMullen::</span>

<span class="sd">    sage: A = AbelianStratum(2)</span>
<span class="sd">    sage: for n in range(3, 17):</span>
<span class="sd">    ....:     q = D.query(stratum=A, nb_squares=n)</span>
<span class="sd">    ....:     print(&quot;%2d %d&quot;%(n, q.number_of()))</span>
<span class="sd">     3 1</span>
<span class="sd">     4 1</span>
<span class="sd">     5 2</span>
<span class="sd">     6 1</span>
<span class="sd">     7 2</span>
<span class="sd">     8 1</span>
<span class="sd">     9 2</span>
<span class="sd">    10 1</span>
<span class="sd">    11 2</span>
<span class="sd">    12 1</span>
<span class="sd">    13 2</span>
<span class="sd">    14 1</span>
<span class="sd">    15 2</span>
<span class="sd">    16 1</span>

<span class="sd">And look at the conjecture of Delecroix-Lelievre in the stratum H(1,1)::</span>

<span class="sd">    sage: A = AbelianStratum(1,1)</span>
<span class="sd">    sage: for n in range(4,20):</span>
<span class="sd">    ....:     q = D.query(stratum=A, nb_squares=n, primitive=True)</span>
<span class="sd">    ....:     print(&quot;%2d %d&quot;%(n, q.number_of()))</span>
<span class="sd">     4 1</span>
<span class="sd">     5 1</span>
<span class="sd">     6 2</span>
<span class="sd">     7 2</span>
<span class="sd">     8 2</span>
<span class="sd">     9 2</span>
<span class="sd">    10 2</span>
<span class="sd">    11 2</span>
<span class="sd">    12 2</span>
<span class="sd">    13 2</span>
<span class="sd">    14 2</span>
<span class="sd">    15 2</span>
<span class="sd">    16 2</span>
<span class="sd">    17 2</span>
<span class="sd">    18 2</span>
<span class="sd">    19 2</span>

<span class="sd">You can get an overview of the content of the database::</span>

<span class="sd">    sage: D.info()</span>
<span class="sd">    genus 2</span>
<span class="sd">    =======</span>
<span class="sd">     H_2(2)^hyp        : 205 T. curves (up to 139 squares)</span>
<span class="sd">     H_2(1^2)^hyp      : 452 T. curves (up to 80 squares)</span>
<span class="sd">    &lt;BLANKLINE&gt;</span>
<span class="sd">    genus 3</span>
<span class="sd">    =======</span>
<span class="sd">     H_3(4)^hyp        : 163 T. curves (up to 51 squares)</span>
<span class="sd">     H_3(4)^odd        : 118 T. curves (up to 41 squares)</span>
<span class="sd">     ...</span>
<span class="sd">    genus 6</span>
<span class="sd">    =======</span>
<span class="sd">     H_6(10)^hyp       :  46 T. curves (up to 15 squares)</span>
<span class="sd">     H_6(10)^odd       :   4 T. curves (up to 11 squares)</span>
<span class="sd">     H_6(10)^even      :  33 T. curves (up to 12 squares)</span>
<span class="sd">    &lt;BLANKLINE&gt;</span>
<span class="sd">    &lt;BLANKLINE&gt;</span>
<span class="sd">    Total: 4688 Teichmueller curves</span>

<span class="sd">Here is a last example of the list of regular origamis (i.e. such that their</span>
<span class="sd">group of translation acts transitively on the set of squares)::</span>

<span class="sd">    sage: q = D.query(regular=True)</span>
<span class="sd">    sage: q.cols(&#39;nb_squares&#39;, &#39;stratum&#39;, &#39;automorphism_group_name&#39;)</span>
<span class="sd">    sage: q.show()</span>
<span class="sd">    Nb squares           Stratum              Automorphism</span>
<span class="sd">    ------------------------------------------------------------</span>
<span class="sd">    6                    H_3(2^2)             S3</span>
<span class="sd">    8                    H_3(1^4)             D8</span>
<span class="sd">    8                    H_3(1^4)             Q8</span>
<span class="sd">    10                   H_5(4^2)             D10</span>
<span class="sd">    12                   H_4(1^6)             A4</span>

<span class="sd">.. TODO::</span>

<span class="sd">    Compute also the index of the image in SL_2(Z/NZ) where N is the congruence</span>
<span class="sd">    level. This can be discriminated by looking at the action on (Z/NZ)^2 (which</span>
<span class="sd">    should be transitive in the case of SL_2(Z/NZ). There are some inverse theorem</span>
<span class="sd">    in Gaby thesis.</span>

<span class="sd">AUTHOR:</span>

<span class="sd">- Vincent Delecroix (2011-2014): initial version</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="c1"># ****************************************************************************</span>
<span class="c1">#       Copyright (C) 2011-2019 Vincent Delecroix &lt;20100.delecroix@gmail.com&gt;</span>
<span class="c1">#</span>
<span class="c1">#  Distributed under the terms of the GNU General Public License (GPL)</span>
<span class="c1">#  as published by the Free Software Foundation; either version 2 of</span>
<span class="c1">#  the License, or (at your option) any later version.</span>
<span class="c1">#                  https://www.gnu.org/licenses/</span>
<span class="c1"># ****************************************************************************</span>

<span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">print_function</span><span class="p">,</span> <span class="n">absolute_import</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">from</span> <span class="nn">six.moves</span> <span class="kn">import</span> <span class="nb">range</span><span class="p">,</span> <span class="nb">map</span><span class="p">,</span> <span class="nb">filter</span><span class="p">,</span> <span class="nb">zip</span>
<span class="kn">from</span> <span class="nn">six</span> <span class="kn">import</span> <span class="n">iteritems</span><span class="p">,</span> <span class="n">string_types</span>

<span class="kn">from</span> <span class="nn">sage.rings.real_mpfr</span> <span class="kn">import</span> <span class="n">RealField</span>
<span class="kn">from</span> <span class="nn">sage.rings.all</span> <span class="kn">import</span> <span class="n">QQ</span><span class="p">,</span> <span class="n">Integer</span>
<span class="kn">from</span> <span class="nn">surface_dynamics.flat_surfaces.origamis.origami</span> <span class="kn">import</span> <span class="n">Origami_dense_pyx</span>
<span class="kn">from</span> <span class="nn">surface_dynamics.flat_surfaces.abelian_strata</span> <span class="kn">import</span> <span class="n">AbelianStratum</span>
<span class="kn">from</span> <span class="nn">surface_dynamics.flat_surfaces.quadratic_strata</span> <span class="kn">import</span> <span class="n">QuadraticStratum</span>
<span class="kn">from</span> <span class="nn">surface_dynamics.flat_surfaces.abelian_strata</span> <span class="kn">import</span> <span class="n">ASC</span><span class="p">,</span> <span class="n">HypASC</span><span class="p">,</span> <span class="n">NonHypASC</span><span class="p">,</span> <span class="n">EvenASC</span><span class="p">,</span> <span class="n">OddASC</span>
<span class="kn">from</span> <span class="nn">surface_dynamics.misc.sql_db</span> <span class="kn">import</span> <span class="n">SQLDatabase</span><span class="p">,</span> <span class="n">SQLQuery</span>


<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">__path__</span> <span class="k">as</span> <span class="n">db_path</span>
<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">db_path</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
    <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;problem with setting paths&quot;</span><span class="p">)</span>
<span class="n">db_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">db_path</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">ORIGAMI_DB_LOCATION</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">db_path</span><span class="p">,</span> <span class="s1">&#39;origamis.db&#39;</span><span class="p">)</span>

<span class="c1"># for primitive and primitive orientation cover</span>
<span class="c1"># classification of primitive group action in GAP (order &lt; )</span>
<span class="c1"># (announced to be up 4096)</span>
<span class="c1">#  gap.NrMovedPoints(G) : number of points on which the group act</span>
<span class="c1">#  gap.PrimitiveIdentification(G) : the index in the primitive group database</span>
<span class="c1">#  to get back the group:</span>
<span class="c1">#  gap.PrimitiveGroup(gap.NrMovedPoints(G),gap.PrimitiveIdentification(G))</span>


<div class="viewcode-block" id="are_skeleton_equal"><a class="viewcode-back" href="../../../../origamis.html#surface_dynamics.flat_surfaces.origamis.origami_database.are_skeleton_equal">[docs]</a><span class="k">def</span> <span class="nf">are_skeleton_equal</span><span class="p">(</span><span class="n">sk1</span><span class="p">,</span> <span class="n">sk2</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Test whether the two skeleton ``sk1`` and ``sk2`` are equals.</span>

<span class="sd">    EXAMPLES::</span>

<span class="sd">        sage: from surface_dynamics.flat_surfaces.origamis.origami_database import are_skeleton_equal</span>
<span class="sd">        sage: sk1 = {&#39;table1&#39;: {&#39;col1&#39;: {&#39;sql&#39;: &#39;TEXT&#39;, &#39;unique&#39;: True}, &#39;col2&#39;: {&#39;sql&#39;: &#39;INTEGER&#39;}}}</span>
<span class="sd">        sage: sk2 = {&#39;table1&#39;: {&#39;col1&#39;: {&#39;sql&#39;: &#39;TEXT&#39;, &#39;unique&#39;: True}, &#39;col2&#39;: {&#39;sql&#39;: &#39;INTEGER&#39;, &#39;unique&#39;: False}}}</span>
<span class="sd">        sage: are_skeleton_equal(sk1,sk2)</span>
<span class="sd">        True</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">set</span><span class="p">(</span><span class="n">sk1</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="o">!=</span> <span class="nb">set</span><span class="p">(</span><span class="n">sk2</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
        <span class="k">return</span> <span class="kc">False</span>

    <span class="k">for</span> <span class="n">table</span> <span class="ow">in</span> <span class="n">sk1</span><span class="p">:</span>
        <span class="n">v1</span> <span class="o">=</span> <span class="n">sk1</span><span class="p">[</span><span class="n">table</span><span class="p">]</span>
        <span class="n">v2</span> <span class="o">=</span> <span class="n">sk2</span><span class="p">[</span><span class="n">table</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">set</span><span class="p">(</span><span class="n">v1</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="o">!=</span> <span class="nb">set</span><span class="p">(</span><span class="n">v2</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
            <span class="k">return</span> <span class="kc">False</span>

        <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">v1</span><span class="p">:</span>
            <span class="n">w1</span> <span class="o">=</span> <span class="n">v1</span><span class="p">[</span><span class="n">col</span><span class="p">]</span>
            <span class="n">w2</span> <span class="o">=</span> <span class="n">v2</span><span class="p">[</span><span class="n">col</span><span class="p">]</span>

            <span class="k">if</span> <span class="n">w1</span><span class="p">[</span><span class="s1">&#39;sql&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="n">w2</span><span class="p">[</span><span class="s1">&#39;sql&#39;</span><span class="p">]:</span>
                <span class="k">return</span> <span class="kc">False</span>
            <span class="k">if</span> <span class="n">w1</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;index&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span> <span class="o">!=</span> <span class="n">w2</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;index&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
                <span class="k">return</span> <span class="kc">False</span>
            <span class="k">if</span> <span class="n">w1</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;unique&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span> <span class="o">!=</span> <span class="n">w2</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;unique&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
                <span class="k">return</span> <span class="kc">False</span>
            <span class="k">if</span> <span class="n">w1</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;primary_key&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span> <span class="o">!=</span> <span class="n">w2</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;primary_key&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
                <span class="k">return</span> <span class="kc">False</span>

    <span class="k">return</span> <span class="kc">True</span></div>


<span class="n">ORIGAMI_DB_skeleton</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;origamis&#39;</span><span class="p">:</span> <span class="p">{</span>
    <span class="c1"># Origami representative</span>
    <span class="s1">&#39;representative&#39;</span>                      <span class="p">:</span> <span class="p">{</span><span class="s1">&#39;sql&#39;</span><span class="p">:</span> <span class="s1">&#39;TEXT&#39;</span><span class="p">,</span> <span class="s1">&#39;unique&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">},</span>

    <span class="c1"># Origami family</span>
    <span class="s1">&#39;primitive&#39;</span>                           <span class="p">:</span> <span class="p">{</span><span class="s1">&#39;sql&#39;</span><span class="p">:</span> <span class="s1">&#39;BOOLEAN&#39;</span><span class="p">},</span>
    <span class="s1">&#39;quasi_primitive&#39;</span>                     <span class="p">:</span> <span class="p">{</span><span class="s1">&#39;sql&#39;</span><span class="p">:</span> <span class="s1">&#39;BOOLEAN&#39;</span><span class="p">},</span>
    <span class="s1">&#39;orientation_cover&#39;</span>                   <span class="p">:</span> <span class="p">{</span><span class="s1">&#39;sql&#39;</span><span class="p">:</span> <span class="s1">&#39;BOOLEAN&#39;</span><span class="p">},</span>
    <span class="s1">&#39;hyperelliptic&#39;</span>                       <span class="p">:</span> <span class="p">{</span><span class="s1">&#39;sql&#39;</span><span class="p">:</span> <span class="s1">&#39;BOOLEAN&#39;</span><span class="p">},</span>
    <span class="s1">&#39;regular&#39;</span>                             <span class="p">:</span> <span class="p">{</span><span class="s1">&#39;sql&#39;</span><span class="p">:</span> <span class="s1">&#39;BOOLEAN&#39;</span><span class="p">},</span>
    <span class="s1">&#39;quasi_regular&#39;</span>                       <span class="p">:</span> <span class="p">{</span><span class="s1">&#39;sql&#39;</span><span class="p">:</span> <span class="s1">&#39;BOOLEAN&#39;</span><span class="p">},</span>

    <span class="c1"># Topological identification</span>
    <span class="s1">&#39;stratum&#39;</span>                             <span class="p">:</span> <span class="p">{</span><span class="s1">&#39;sql&#39;</span><span class="p">:</span> <span class="s1">&#39;TEXT&#39;</span><span class="p">,</span>    <span class="s1">&#39;index&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">},</span>
    <span class="s1">&#39;component&#39;</span>                           <span class="p">:</span> <span class="p">{</span><span class="s1">&#39;sql&#39;</span><span class="p">:</span> <span class="s1">&#39;TEXT&#39;</span><span class="p">,</span>    <span class="s1">&#39;index&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">},</span>
    <span class="s1">&#39;genus&#39;</span>                               <span class="p">:</span> <span class="p">{</span><span class="s1">&#39;sql&#39;</span><span class="p">:</span> <span class="s1">&#39;INTEGER&#39;</span><span class="p">,</span> <span class="s1">&#39;index&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">},</span>
    <span class="s1">&#39;nb_squares&#39;</span>                          <span class="p">:</span> <span class="p">{</span><span class="s1">&#39;sql&#39;</span><span class="p">:</span> <span class="s1">&#39;INTEGER&#39;</span><span class="p">,</span> <span class="s1">&#39;index&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">},</span>
    <span class="s1">&#39;optimal_degree&#39;</span>                      <span class="p">:</span> <span class="p">{</span><span class="s1">&#39;sql&#39;</span><span class="p">:</span> <span class="s1">&#39;INTEGER&#39;</span><span class="p">,</span> <span class="s1">&#39;index&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">},</span>

    <span class="c1"># Veech group data</span>
    <span class="s1">&#39;veech_group_index&#39;</span>                   <span class="p">:</span> <span class="p">{</span><span class="s1">&#39;sql&#39;</span><span class="p">:</span> <span class="s1">&#39;INTEGER&#39;</span><span class="p">},</span>
    <span class="s1">&#39;veech_group_congruence&#39;</span>              <span class="p">:</span> <span class="p">{</span><span class="s1">&#39;sql&#39;</span><span class="p">:</span> <span class="s1">&#39;BOOLEAN&#39;</span><span class="p">},</span>
    <span class="s1">&#39;veech_group_level&#39;</span>                   <span class="p">:</span> <span class="p">{</span><span class="s1">&#39;sql&#39;</span><span class="p">:</span> <span class="s1">&#39;INTEGER&#39;</span><span class="p">},</span>
    <span class="s1">&#39;teich_curve_ncusps&#39;</span>                  <span class="p">:</span> <span class="p">{</span><span class="s1">&#39;sql&#39;</span><span class="p">:</span> <span class="s1">&#39;INTEGER&#39;</span><span class="p">},</span>
    <span class="s1">&#39;teich_curve_nu2&#39;</span>                     <span class="p">:</span> <span class="p">{</span><span class="s1">&#39;sql&#39;</span><span class="p">:</span> <span class="s1">&#39;INTEGER&#39;</span><span class="p">},</span>
    <span class="s1">&#39;teich_curve_nu3&#39;</span>                     <span class="p">:</span> <span class="p">{</span><span class="s1">&#39;sql&#39;</span><span class="p">:</span> <span class="s1">&#39;INTEGER&#39;</span><span class="p">},</span>
    <span class="s1">&#39;teich_curve_genus&#39;</span>                   <span class="p">:</span> <span class="p">{</span><span class="s1">&#39;sql&#39;</span><span class="p">:</span> <span class="s1">&#39;INTEGER&#39;</span><span class="p">},</span>

    <span class="c1"># Geometry and Lyapunov exponents</span>
    <span class="s1">&#39;sum_of_L_exp&#39;</span>                        <span class="p">:</span> <span class="p">{</span><span class="s1">&#39;sql&#39;</span><span class="p">:</span> <span class="s1">&#39;TEXT&#39;</span><span class="p">},</span>
    <span class="s1">&#39;L_exp_approx&#39;</span>                        <span class="p">:</span> <span class="p">{</span><span class="s1">&#39;sql&#39;</span><span class="p">:</span> <span class="s1">&#39;TEXT&#39;</span><span class="p">},</span>
    <span class="s1">&#39;min_nb_of_cyls&#39;</span>                      <span class="p">:</span> <span class="p">{</span><span class="s1">&#39;sql&#39;</span><span class="p">:</span> <span class="s1">&#39;INTEGER&#39;</span><span class="p">},</span>
    <span class="s1">&#39;max_nb_of_cyls&#39;</span>                      <span class="p">:</span> <span class="p">{</span><span class="s1">&#39;sql&#39;</span><span class="p">:</span> <span class="s1">&#39;INTEGER&#39;</span><span class="p">},</span>
    <span class="s1">&#39;min_hom_dim&#39;</span>                         <span class="p">:</span> <span class="p">{</span><span class="s1">&#39;sql&#39;</span><span class="p">:</span> <span class="s1">&#39;INTEGER&#39;</span><span class="p">},</span>
    <span class="s1">&#39;max_hom_dim&#39;</span>                         <span class="p">:</span> <span class="p">{</span><span class="s1">&#39;sql&#39;</span><span class="p">:</span> <span class="s1">&#39;INTEGER&#39;</span><span class="p">},</span>
    <span class="s1">&#39;minus_identity_invariant&#39;</span>            <span class="p">:</span> <span class="p">{</span><span class="s1">&#39;sql&#39;</span><span class="p">:</span> <span class="s1">&#39;BOOLEAN&#39;</span><span class="p">},</span>

    <span class="c1"># monodromy data</span>
    <span class="s1">&#39;monodromy_name&#39;</span>                      <span class="p">:</span> <span class="p">{</span><span class="s1">&#39;sql&#39;</span><span class="p">:</span> <span class="s1">&#39;TEXT&#39;</span><span class="p">,</span>    <span class="s1">&#39;index&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">},</span>
    <span class="s1">&#39;monodromy_signature&#39;</span>                 <span class="p">:</span> <span class="p">{</span><span class="s1">&#39;sql&#39;</span><span class="p">:</span> <span class="s1">&#39;BOOLEAN&#39;</span><span class="p">,</span> <span class="s1">&#39;index&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">},</span>
    <span class="s1">&#39;monodromy_index&#39;</span>                     <span class="p">:</span> <span class="p">{</span><span class="s1">&#39;sql&#39;</span><span class="p">:</span> <span class="s1">&#39;INTEGER&#39;</span><span class="p">,</span> <span class="s1">&#39;index&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">},</span>
    <span class="s1">&#39;monodromy_order&#39;</span>                     <span class="p">:</span> <span class="p">{</span><span class="s1">&#39;sql&#39;</span><span class="p">:</span> <span class="s1">&#39;INTEGER&#39;</span><span class="p">},</span>
    <span class="s1">&#39;monodromy_solvable&#39;</span>                  <span class="p">:</span> <span class="p">{</span><span class="s1">&#39;sql&#39;</span><span class="p">:</span> <span class="s1">&#39;BOOLEAN&#39;</span><span class="p">},</span>
    <span class="s1">&#39;monodromy_nilpotent&#39;</span>                 <span class="p">:</span> <span class="p">{</span><span class="s1">&#39;sql&#39;</span><span class="p">:</span> <span class="s1">&#39;BOOLEAN&#39;</span><span class="p">},</span>
    <span class="s1">&#39;monodromy_gap_primitive_id&#39;</span>          <span class="p">:</span> <span class="p">{</span><span class="s1">&#39;sql&#39;</span><span class="p">:</span> <span class="s1">&#39;INTEGER&#39;</span><span class="p">},</span>
    <span class="s1">&#39;relative_monodromy_name&#39;</span>             <span class="p">:</span> <span class="p">{</span><span class="s1">&#39;sql&#39;</span><span class="p">:</span> <span class="s1">&#39;TEXT&#39;</span><span class="p">,</span>    <span class="s1">&#39;index&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">},</span>
    <span class="s1">&#39;relative_monodromy_signature&#39;</span>        <span class="p">:</span> <span class="p">{</span><span class="s1">&#39;sql&#39;</span><span class="p">:</span> <span class="s1">&#39;BOOLEAN&#39;</span><span class="p">,</span> <span class="s1">&#39;index&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">},</span>
    <span class="s1">&#39;relative_monodromy_index&#39;</span>            <span class="p">:</span> <span class="p">{</span><span class="s1">&#39;sql&#39;</span><span class="p">:</span> <span class="s1">&#39;INTEGER&#39;</span><span class="p">,</span> <span class="s1">&#39;index&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">},</span>
    <span class="s1">&#39;relative_monodromy_order&#39;</span>            <span class="p">:</span> <span class="p">{</span><span class="s1">&#39;sql&#39;</span><span class="p">:</span> <span class="s1">&#39;INTEGER&#39;</span><span class="p">},</span>
    <span class="s1">&#39;relative_monodromy_solvable&#39;</span>         <span class="p">:</span> <span class="p">{</span><span class="s1">&#39;sql&#39;</span><span class="p">:</span> <span class="s1">&#39;BOOLEAN&#39;</span><span class="p">},</span>
    <span class="s1">&#39;relative_monodromy_nilpotent&#39;</span>        <span class="p">:</span> <span class="p">{</span><span class="s1">&#39;sql&#39;</span><span class="p">:</span> <span class="s1">&#39;BOOLEAN&#39;</span><span class="p">},</span>
    <span class="s1">&#39;relative_monodromy_gap_primitive_id&#39;</span> <span class="p">:</span> <span class="p">{</span><span class="s1">&#39;sql&#39;</span><span class="p">:</span> <span class="s1">&#39;INTEGER&#39;</span><span class="p">},</span>

    <span class="c1"># potential orientation data</span>
    <span class="s1">&#39;orientation_stratum&#39;</span>                 <span class="p">:</span> <span class="p">{</span><span class="s1">&#39;sql&#39;</span><span class="p">:</span> <span class="s1">&#39;TEXT&#39;</span><span class="p">},</span>
    <span class="s1">&#39;orientation_genus&#39;</span>                   <span class="p">:</span> <span class="p">{</span><span class="s1">&#39;sql&#39;</span><span class="p">:</span> <span class="s1">&#39;INTEGER&#39;</span><span class="p">},</span>
    <span class="s1">&#39;pole_partition&#39;</span>                      <span class="p">:</span> <span class="p">{</span><span class="s1">&#39;sql&#39;</span><span class="p">:</span> <span class="s1">&#39;TEXT&#39;</span><span class="p">},</span>

    <span class="c1"># automorphism</span>
    <span class="s1">&#39;automorphism_group_order&#39;</span>            <span class="p">:</span> <span class="p">{</span><span class="s1">&#39;sql&#39;</span><span class="p">:</span> <span class="s1">&#39;INTEGER&#39;</span><span class="p">},</span>
    <span class="s1">&#39;automorphism_group_name&#39;</span>             <span class="p">:</span> <span class="p">{</span><span class="s1">&#39;sql&#39;</span><span class="p">:</span> <span class="s1">&#39;TEXT&#39;</span><span class="p">},</span>
<span class="p">}}</span>


<span class="n">ORIGAMI_DB_cols</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;representative&#39;</span><span class="p">,</span> <span class="s1">&#39;stratum&#39;</span><span class="p">,</span> <span class="s1">&#39;component&#39;</span><span class="p">,</span> <span class="s1">&#39;primitive&#39;</span><span class="p">,</span>
<span class="s1">&#39;quasi_primitive&#39;</span><span class="p">,</span> <span class="s1">&#39;orientation_cover&#39;</span><span class="p">,</span>
<span class="s1">&#39;hyperelliptic&#39;</span><span class="p">,</span> <span class="s1">&#39;regular&#39;</span><span class="p">,</span> <span class="s1">&#39;quasi_regular&#39;</span><span class="p">,</span> <span class="s1">&#39;genus&#39;</span><span class="p">,</span> <span class="s1">&#39;nb_squares&#39;</span><span class="p">,</span> <span class="s1">&#39;optimal_degree&#39;</span><span class="p">,</span>
<span class="s1">&#39;veech_group_index&#39;</span><span class="p">,</span> <span class="s1">&#39;veech_group_congruence&#39;</span><span class="p">,</span> <span class="s1">&#39;veech_group_level&#39;</span><span class="p">,</span>
<span class="s1">&#39;teich_curve_ncusps&#39;</span><span class="p">,</span> <span class="s1">&#39;teich_curve_nu2&#39;</span><span class="p">,</span> <span class="s1">&#39;teich_curve_nu3&#39;</span><span class="p">,</span> <span class="s1">&#39;teich_curve_genus&#39;</span><span class="p">,</span>
<span class="s1">&#39;sum_of_L_exp&#39;</span><span class="p">,</span> <span class="s1">&#39;L_exp_approx&#39;</span><span class="p">,</span> <span class="s1">&#39;min_nb_of_cyls&#39;</span><span class="p">,</span> <span class="s1">&#39;max_nb_of_cyls&#39;</span><span class="p">,</span>
<span class="s1">&#39;min_hom_dim&#39;</span><span class="p">,</span> <span class="s1">&#39;max_hom_dim&#39;</span><span class="p">,</span> <span class="s1">&#39;minus_identity_invariant&#39;</span><span class="p">,</span> <span class="s1">&#39;monodromy_name&#39;</span><span class="p">,</span>
<span class="s1">&#39;monodromy_signature&#39;</span><span class="p">,</span> <span class="s1">&#39;monodromy_index&#39;</span><span class="p">,</span> <span class="s1">&#39;monodromy_order&#39;</span><span class="p">,</span>
<span class="s1">&#39;monodromy_solvable&#39;</span><span class="p">,</span> <span class="s1">&#39;monodromy_nilpotent&#39;</span><span class="p">,</span> <span class="s1">&#39;monodromy_gap_primitive_id&#39;</span><span class="p">,</span>
<span class="s1">&#39;relative_monodromy_name&#39;</span><span class="p">,</span>
<span class="s1">&#39;relative_monodromy_signature&#39;</span><span class="p">,</span> <span class="s1">&#39;relative_monodromy_index&#39;</span><span class="p">,</span> <span class="s1">&#39;relative_monodromy_order&#39;</span><span class="p">,</span>
<span class="s1">&#39;relative_monodromy_solvable&#39;</span><span class="p">,</span> <span class="s1">&#39;relative_monodromy_nilpotent&#39;</span><span class="p">,</span> <span class="s1">&#39;relative_monodromy_gap_primitive_id&#39;</span><span class="p">,</span>
<span class="s1">&#39;orientation_stratum&#39;</span><span class="p">,</span> <span class="s1">&#39;orientation_genus&#39;</span><span class="p">,</span>
<span class="s1">&#39;pole_partition&#39;</span><span class="p">,</span> <span class="s1">&#39;automorphism_group_order&#39;</span><span class="p">,</span> <span class="s1">&#39;automorphism_group_name&#39;</span><span class="p">]</span>


<span class="c1"># backward compatibility with previous versions of the database</span>
<span class="c1"># each line of ``added_cols`` correspond to a newly added information</span>
<span class="c1"># once you modify the table structure, add a line there</span>
<span class="n">OLDS</span> <span class="o">=</span> <span class="p">[]</span>

<span class="n">OLD_ORIGAMI_DB_skeleton</span> <span class="o">=</span> <span class="n">ORIGAMI_DB_skeleton</span><span class="p">[</span><span class="s1">&#39;origamis&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">OLD_ORIGAMI_DB_cols</span> <span class="o">=</span> <span class="n">ORIGAMI_DB_cols</span><span class="p">[:]</span>
<span class="n">added_cols</span> <span class="o">=</span> <span class="p">[</span>
<span class="p">(</span><span class="s1">&#39;relative_monodromy_name&#39;</span><span class="p">,</span>
 <span class="s1">&#39;relative_monodromy_signature&#39;</span><span class="p">,</span> <span class="s1">&#39;relative_monodromy_index&#39;</span><span class="p">,</span> <span class="s1">&#39;relative_monodromy_order&#39;</span><span class="p">,</span>
 <span class="s1">&#39;relative_monodromy_solvable&#39;</span><span class="p">,</span> <span class="s1">&#39;relative_monodromy_nilpotent&#39;</span><span class="p">,</span>
 <span class="s1">&#39;relative_monodromy_gap_primitive_id&#39;</span><span class="p">),</span>
<span class="p">(</span><span class="s1">&#39;quasi_primitive&#39;</span><span class="p">,),</span>
<span class="p">(</span><span class="s1">&#39;optimal_degree&#39;</span><span class="p">,)</span>
<span class="p">]</span>

<span class="k">for</span> <span class="n">cols</span> <span class="ow">in</span> <span class="n">added_cols</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">cols</span><span class="p">:</span>
        <span class="k">del</span> <span class="n">OLD_ORIGAMI_DB_skeleton</span><span class="p">[</span><span class="n">col</span><span class="p">]</span>
        <span class="n">OLD_ORIGAMI_DB_cols</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">col</span><span class="p">)</span>
    <span class="n">OLDS</span><span class="o">.</span><span class="n">append</span><span class="p">(({</span><span class="s1">&#39;origamis&#39;</span><span class="p">:</span> <span class="n">OLD_ORIGAMI_DB_skeleton</span><span class="o">.</span><span class="n">copy</span><span class="p">()},</span> <span class="n">OLD_ORIGAMI_DB_cols</span><span class="p">[:]))</span>

<span class="c1">#</span>
<span class="c1"># relabelization of columns</span>
<span class="c1">#</span>

<span class="n">relabel_cols</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">ORIGAMI_DB_skeleton</span><span class="p">[</span><span class="s1">&#39;origamis&#39;</span><span class="p">]:</span>
    <span class="n">split_col</span> <span class="o">=</span> <span class="n">col</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)</span>
    <span class="n">relabel_cols</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="n">split_col</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">capitalize</span><span class="p">()</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">split_col</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
<span class="n">relabel_cols</span><span class="p">[</span><span class="s1">&#39;representative&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Origami&#39;</span>
<span class="n">relabel_cols</span><span class="p">[</span><span class="s1">&#39;component&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Comp.&#39;</span>
<span class="n">relabel_cols</span><span class="p">[</span><span class="s1">&#39;orientation_cover&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Quad. diff.&#39;</span>
<span class="n">relabel_cols</span><span class="p">[</span><span class="s1">&#39;monodromy_name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Monodromy&#39;</span>
<span class="n">relabel_cols</span><span class="p">[</span><span class="s1">&#39;relative_monodromy_name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Rel. monodromy&#39;</span>
<span class="n">relabel_cols</span><span class="p">[</span><span class="s1">&#39;automorphism_group_name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Automorphism&#39;</span>
<span class="n">relabel_cols</span><span class="p">[</span><span class="s1">&#39;veech_group_index&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;vg index&#39;</span>
<span class="n">relabel_cols</span><span class="p">[</span><span class="s1">&#39;veech_group_congruence&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;vg congruence&#39;</span>
<span class="n">relabel_cols</span><span class="p">[</span><span class="s1">&#39;veech_group_level&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;vg level&#39;</span>


<span class="c1">#</span>
<span class="c1"># raw data to sqldatatype conversion</span>
<span class="c1">#</span>

<div class="viewcode-block" id="real_tuple_to_data"><a class="viewcode-back" href="../../../../origamis.html#surface_dynamics.flat_surfaces.origamis.origami_database.real_tuple_to_data">[docs]</a><span class="k">def</span> <span class="nf">real_tuple_to_data</span><span class="p">(</span><span class="n">t</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Convert a tuple of real numbers with same precision into a string.</span>

<span class="sd">    The output string is a list of numbers written in base 36 (0, 1, ..., 9, a,</span>
<span class="sd">    b, ..., z) separated by space &#39; &#39;. The first number is the precision of the</span>
<span class="sd">    real field. Then each real number consists of three numbers as sign,</span>
<span class="sd">    mantissa, exponent.</span>

<span class="sd">    EXAMPLES::</span>

<span class="sd">        sage: from surface_dynamics import *</span>

<span class="sd">        sage: import surface_dynamics.flat_surfaces.origamis.origami_database as odb</span>
<span class="sd">        sage: odb.real_tuple_to_data((1.23,-4.0))</span>
<span class="sd">        &#39;1h 1 1ijk9vqiyzy -1g -1 18ce53un18g -1e&#39;</span>

<span class="sd">    We may check that the first part consists of the precision::</span>

<span class="sd">        sage: Integer(&#39;1h&#39;, 36)</span>
<span class="sd">        53</span>
<span class="sd">        sage: RR.precision()</span>
<span class="sd">        53</span>

<span class="sd">    And then of the two real numbers we input::</span>

<span class="sd">        sage: sign = Integer(&#39;1&#39;, 36)</span>
<span class="sd">        sage: mantissa = Integer(&#39;1ijk9vqiyzy&#39;, 36)</span>
<span class="sd">        sage: exponent = Integer(&#39;-1g&#39;, 36)</span>
<span class="sd">        sage: RR(sign * mantissa * 2 ** exponent)</span>
<span class="sd">        1.23000000000000</span>

<span class="sd">        sage: sign = Integer(&#39;-1&#39;, 36)</span>
<span class="sd">        sage: mantissa = Integer(&#39;18ce53un18g&#39;, 36)</span>
<span class="sd">        sage: exponent = Integer(&#39;-1e&#39;, 36)</span>
<span class="sd">        sage: RR(sign * mantissa * 2 ** exponent)</span>
<span class="sd">        -4.00000000000000</span>

<span class="sd">    TESTS::</span>

<span class="sd">        sage: import surface_dynamics.flat_surfaces.origamis.origami_database as odb</span>
<span class="sd">        sage: t = (RR(5.0), RR(pi))</span>
<span class="sd">        sage: t</span>
<span class="sd">        (5.00000000000000, 3.14159265358979)</span>
<span class="sd">        sage: s = odb.real_tuple_to_data(t)</span>
<span class="sd">        sage: isinstance(s,str)</span>
<span class="sd">        True</span>
<span class="sd">        sage: t == odb.data_to_real_tuple(s)</span>
<span class="sd">        True</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">t</span><span class="p">:</span>
        <span class="k">return</span> <span class="s1">&#39;&#39;</span>
    <span class="n">prec</span> <span class="o">=</span> <span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">prec</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">t</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">x</span><span class="o">.</span><span class="n">prec</span><span class="p">()</span> <span class="o">!=</span> <span class="n">prec</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;all reals in the tuple should have the same precision&quot;</span><span class="p">)</span>
    <span class="n">s</span> <span class="o">=</span> <span class="n">Integer</span><span class="p">(</span><span class="n">prec</span><span class="p">)</span><span class="o">.</span><span class="n">str</span><span class="p">(</span><span class="mi">36</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">t</span><span class="p">:</span>
        <span class="n">s</span> <span class="o">+=</span> <span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="n">integer_tuple_to_data</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">sign_mantissa_exponent</span><span class="p">())</span>
    <span class="k">return</span> <span class="n">s</span></div>


<div class="viewcode-block" id="data_to_real_tuple"><a class="viewcode-back" href="../../../../origamis.html#surface_dynamics.flat_surfaces.origamis.origami_database.data_to_real_tuple">[docs]</a><span class="k">def</span> <span class="nf">data_to_real_tuple</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Convert a string into a tuple of real numbers.</span>

<span class="sd">    For the encoding convention, see meth:`real_tuple_to_data`.</span>

<span class="sd">    EXAMPLES::</span>

<span class="sd">        sage: from surface_dynamics import *</span>

<span class="sd">        sage: import surface_dynamics.flat_surfaces.origamis.origami_database as odb</span>
<span class="sd">        sage: R = RealField(22)</span>
<span class="sd">        sage: t = (R(1), R(pi))</span>
<span class="sd">        sage: s = odb.real_tuple_to_data(t)</span>
<span class="sd">        sage: tt = odb.data_to_real_tuple(s)</span>
<span class="sd">        sage: tt == t</span>
<span class="sd">        True</span>
<span class="sd">        sage: tt[0].parent()</span>
<span class="sd">        Real Field with 22 bits of precision</span>
<span class="sd">        sage: tt[1].parent()</span>
<span class="sd">        Real Field with 22 bits of precision</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">s</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">()</span>
    <span class="n">s</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
    <span class="n">prec</span> <span class="o">=</span> <span class="n">Integer</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">36</span><span class="p">)</span>
    <span class="n">s</span> <span class="o">=</span> <span class="n">s</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
    <span class="n">R</span> <span class="o">=</span> <span class="n">RealField</span><span class="p">(</span><span class="n">prec</span><span class="p">)</span>
    <span class="n">res</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">),</span> <span class="mi">3</span><span class="p">):</span>
        <span class="n">sign</span><span class="p">,</span> <span class="n">mantissa</span><span class="p">,</span> <span class="n">exponent</span> <span class="o">=</span> <span class="n">data_to_integer_tuple</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">2</span><span class="p">])</span>
        <span class="n">res</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">R</span><span class="p">(</span><span class="n">sign</span> <span class="o">*</span> <span class="n">mantissa</span> <span class="o">*</span> <span class="mi">2</span><span class="o">**</span><span class="n">exponent</span><span class="p">))</span>
    <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">res</span><span class="p">)</span></div>


<div class="viewcode-block" id="small_positive_integer_tuple_to_data"><a class="viewcode-back" href="../../../../origamis.html#surface_dynamics.flat_surfaces.origamis.origami_database.small_positive_integer_tuple_to_data">[docs]</a><span class="k">def</span> <span class="nf">small_positive_integer_tuple_to_data</span><span class="p">(</span><span class="n">t</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Convert a tuple of integers between 0 and 35 to a string.</span>

<span class="sd">    The encoding consists of a string of the same length as ``t`` where each</span>
<span class="sd">    character is the representation of the number in base `36` (0, 1, ..., 9, a,</span>
<span class="sd">    b, ..., z).</span>

<span class="sd">    EXAMPLES::</span>

<span class="sd">        sage: from surface_dynamics import *</span>

<span class="sd">        sage: import surface_dynamics.flat_surfaces.origamis.origami_database as odb</span>
<span class="sd">        sage: t = (0, 35, 25, 2, 12)</span>
<span class="sd">        sage: s = odb.small_positive_integer_tuple_to_data(t)</span>
<span class="sd">        sage: s</span>
<span class="sd">        &#39;0zp2c&#39;</span>
<span class="sd">        sage: list(map(lambda x: Integer(x, 36), s))</span>
<span class="sd">        [0, 35, 25, 2, 12]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">t</span><span class="p">:</span>
        <span class="k">return</span> <span class="s1">&#39;&#39;</span>
    <span class="k">assert</span> <span class="nb">all</span><span class="p">(</span><span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">36</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">t</span><span class="p">)</span>
    <span class="k">return</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">Integer</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">str</span><span class="p">(</span><span class="mi">36</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">t</span><span class="p">)</span></div>


<div class="viewcode-block" id="data_to_small_positive_integer_tuple"><a class="viewcode-back" href="../../../../origamis.html#surface_dynamics.flat_surfaces.origamis.origami_database.data_to_small_positive_integer_tuple">[docs]</a><span class="k">def</span> <span class="nf">data_to_small_positive_integer_tuple</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Convert a string into a tuple of Integer.</span>

<span class="sd">    For encoding convention, see meth:`small_positive_integer_tuple_to_data`.</span>

<span class="sd">    EXAMPLES::</span>

<span class="sd">        sage: from surface_dynamics import *</span>

<span class="sd">        sage: import surface_dynamics.flat_surfaces.origamis.origami_database as odb</span>
<span class="sd">        sage: odb.data_to_small_positive_integer_tuple(&#39;14m&#39;)</span>
<span class="sd">        (1, 4, 22)</span>
<span class="sd">        sage: odb.data_to_small_positive_integer_tuple(&#39;&#39;)</span>
<span class="sd">        ()</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">s</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">()</span>
    <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">Integer</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="mi">36</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">s</span><span class="p">)</span></div>

<div class="viewcode-block" id="integer_tuple_to_data"><a class="viewcode-back" href="../../../../origamis.html#surface_dynamics.flat_surfaces.origamis.origami_database.integer_tuple_to_data">[docs]</a><span class="k">def</span> <span class="nf">integer_tuple_to_data</span><span class="p">(</span><span class="n">t</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Convert a tuple of arbitrary integers into a string.</span>

<span class="sd">    The encoding consists in a string that are representation of the integers in</span>
<span class="sd">    base 36 separated by space.</span>

<span class="sd">    EXAMPLES::</span>

<span class="sd">        sage: from surface_dynamics import *</span>

<span class="sd">        sage: import surface_dynamics.flat_surfaces.origamis.origami_database as odb</span>
<span class="sd">        sage: t = (0,-12435123,3)</span>
<span class="sd">        sage: s = odb.integer_tuple_to_data(t)</span>
<span class="sd">        sage: s</span>
<span class="sd">        &#39;0 -7ej03 3&#39;</span>
<span class="sd">        sage: list(map(lambda x: Integer(x,36), s.split(&#39; &#39;)))</span>
<span class="sd">        [0, -12435123, 3]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">t</span><span class="p">:</span>
        <span class="k">return</span> <span class="s1">&#39;&#39;</span>
    <span class="k">return</span> <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">Integer</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">str</span><span class="p">(</span><span class="mi">36</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">t</span><span class="p">)</span></div>

<div class="viewcode-block" id="data_to_integer_tuple"><a class="viewcode-back" href="../../../../origamis.html#surface_dynamics.flat_surfaces.origamis.origami_database.data_to_integer_tuple">[docs]</a><span class="k">def</span> <span class="nf">data_to_integer_tuple</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Convert a string into a tuple of integers.</span>

<span class="sd">    For the encoding convention, see meth:`integer_tuple_to_data`.</span>

<span class="sd">    EXAMPLES::</span>

<span class="sd">        sage: import surface_dynamics.flat_surfaces.origamis.origami_database as odb</span>
<span class="sd">        sage: t = (-12, 351234123, 45)</span>
<span class="sd">        sage: s = odb.integer_tuple_to_data(t)</span>
<span class="sd">        sage: odb.data_to_integer_tuple(s) == t</span>
<span class="sd">        True</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">s</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">()</span>
    <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">Integer</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="mi">36</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">s</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">))</span></div>


<span class="n">rational_to_data</span> <span class="o">=</span> <span class="nb">str</span>
<span class="n">data_to_rational</span> <span class="o">=</span> <span class="n">QQ</span>


<div class="viewcode-block" id="square_num_to_str"><a class="viewcode-back" href="../../../../origamis.html#surface_dynamics.flat_surfaces.origamis.origami_database.square_num_to_str">[docs]</a><span class="k">def</span> <span class="nf">square_num_to_str</span><span class="p">(</span><span class="n">i</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">80</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">chr</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">48</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="n">Integer</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">.</span><span class="n">str</span><span class="p">(</span><span class="mi">16</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span></div>


<div class="viewcode-block" id="representative_to_data"><a class="viewcode-back" href="../../../../origamis.html#surface_dynamics.flat_surfaces.origamis.origami_database.representative_to_data">[docs]</a><span class="k">def</span> <span class="nf">representative_to_data</span><span class="p">(</span><span class="n">o</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The maximum number of squares is 95. The encoding consists of the</span>
<span class="sd">    concatenation of the two permutations that define the origami.</span>

<span class="sd">    TESTS::</span>

<span class="sd">        sage: from surface_dynamics import *</span>

<span class="sd">        sage: import surface_dynamics.flat_surfaces.origamis.origami_database as odb</span>
<span class="sd">        sage: o = Origami(&#39;(1,2,3)&#39;,&#39;(3,2,1)&#39;)</span>
<span class="sd">        sage: odb.representative_to_data(o)</span>
<span class="sd">        &#39;120201&#39;</span>
<span class="sd">        sage: o = Origami(&#39;(1,2,4,3)(5,7,6)(10,9)&#39;,&#39;(10,8,6,2,4,3,1)&#39;)</span>
<span class="sd">        sage: s = odb.representative_to_data(o)</span>
<span class="sd">        sage: isinstance(s,str)</span>
<span class="sd">        True</span>
<span class="sd">        sage: o == odb.data_to_representative(s)</span>
<span class="sd">        True</span>

<span class="sd">    Try examples in the critical range 75-85:</span>

<span class="sd">        sage: for n in range(75,85):</span>
<span class="sd">        ....:     r = list(range(1,n)) + [0]</span>
<span class="sd">        ....:     u = list(range(n))</span>
<span class="sd">        ....:     shuffle(u)</span>
<span class="sd">        ....:     o = Origami(r, u, as_tuple=True)</span>
<span class="sd">        ....:     s = odb.representative_to_data(o)</span>
<span class="sd">        ....:     assert o == odb.data_to_representative(s)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">o</span><span class="o">.</span><span class="n">nb_squares</span><span class="p">()</span> <span class="o">&lt;</span> <span class="mi">80</span><span class="p">:</span>
        <span class="c1"># for the first 79 characters we simply use chr(48+i) that is</span>
        <span class="c1"># 0, 1, 2, 3, 4, 5, 6, 7, 8, 9 etc</span>
        <span class="n">rs</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">chr</span><span class="p">(</span><span class="mi">48</span><span class="o">+</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">o</span><span class="o">.</span><span class="n">r_tuple</span><span class="p">())</span>
        <span class="n">us</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">chr</span><span class="p">(</span><span class="mi">48</span><span class="o">+</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">o</span><span class="o">.</span><span class="n">u_tuple</span><span class="p">())</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># for 80 or more squares we use the space to separate base 36 encodings</span>
        <span class="n">rs</span> <span class="o">=</span> <span class="n">integer_tuple_to_data</span><span class="p">(</span><span class="n">o</span><span class="o">.</span><span class="n">r_tuple</span><span class="p">())</span>
        <span class="n">us</span> <span class="o">=</span> <span class="n">integer_tuple_to_data</span><span class="p">(</span><span class="n">o</span><span class="o">.</span><span class="n">u_tuple</span><span class="p">())</span>
    <span class="k">return</span> <span class="n">rs</span> <span class="o">+</span> <span class="n">us</span></div>

<div class="viewcode-block" id="data_to_representative"><a class="viewcode-back" href="../../../../origamis.html#surface_dynamics.flat_surfaces.origamis.origami_database.data_to_representative">[docs]</a><span class="k">def</span> <span class="nf">data_to_representative</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Convert data to representative.</span>

<span class="sd">    For encoding convention, see meth:`representative_to_data`.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="o">//</span> <span class="mi">2</span>
    <span class="n">rs</span> <span class="o">=</span> <span class="n">s</span><span class="p">[:</span><span class="n">n</span><span class="p">]</span>
    <span class="n">us</span> <span class="o">=</span> <span class="n">s</span><span class="p">[</span><span class="n">n</span><span class="p">:]</span>
    <span class="k">if</span> <span class="n">n</span> <span class="o">&lt;</span> <span class="mi">80</span><span class="p">:</span>
        <span class="n">r</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="nb">ord</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">-</span><span class="mi">48</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">rs</span><span class="p">)</span>
        <span class="n">u</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="nb">ord</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">-</span><span class="mi">48</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">us</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">data_to_integer_tuple</span><span class="p">(</span><span class="n">rs</span><span class="p">)</span>
        <span class="n">u</span> <span class="o">=</span> <span class="n">data_to_integer_tuple</span><span class="p">(</span><span class="n">us</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">Origami_dense_pyx</span><span class="p">(</span><span class="n">r</span><span class="p">,</span><span class="n">u</span><span class="p">)</span></div>


<div class="viewcode-block" id="format_representative"><a class="viewcode-back" href="../../../../origamis.html#surface_dynamics.flat_surfaces.origamis.origami_database.format_representative">[docs]</a><span class="k">def</span> <span class="nf">format_representative</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Convert a string that encodes an origami into a human readable string.</span>

<span class="sd">    The output form consists of the concatenation of the cycles without the</span>
<span class="sd">    parenthesis. In other words the permutation `(1,5)(2)(3,7,4)` will be</span>
<span class="sd">    convert into &#39;15 374&#39;.</span>

<span class="sd">    EXAMPLES::</span>

<span class="sd">        sage: from surface_dynamics import *</span>

<span class="sd">        sage: import surface_dynamics.flat_surfaces.origamis.origami_database as odb</span>
<span class="sd">        sage: o = Origami(&#39;(1,2)&#39;,&#39;(1,3)&#39;)</span>
<span class="sd">        sage: s = odb.representative_to_data(o)</span>
<span class="sd">        sage: odb.format_representative(s)</span>
<span class="sd">        &#39;r=12  u=13&#39;</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">o</span> <span class="o">=</span> <span class="n">data_to_representative</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">o</span><span class="o">.</span><span class="n">r</span><span class="p">()</span><span class="o">.</span><span class="n">cycle_tuples</span><span class="p">()</span>
    <span class="n">u</span> <span class="o">=</span> <span class="n">o</span><span class="o">.</span><span class="n">u</span><span class="p">()</span><span class="o">.</span><span class="n">cycle_tuples</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">format_cycles</span><span class="p">(</span><span class="n">cycles</span><span class="p">):</span>
        <span class="k">return</span> <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">Integer</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">str</span><span class="p">(</span><span class="mi">36</span><span class="p">),</span> <span class="n">c</span><span class="p">))</span>
                        <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">cycles</span><span class="p">)</span>

    <span class="k">return</span> <span class="s1">&#39;r=&#39;</span> <span class="o">+</span> <span class="n">format_cycles</span><span class="p">(</span><span class="n">r</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;  u=&#39;</span> <span class="o">+</span> <span class="n">format_cycles</span><span class="p">(</span><span class="n">u</span><span class="p">)</span></div>


<span class="c1"># stratum and component</span>
<div class="viewcode-block" id="stratum_to_data"><a class="viewcode-back" href="../../../../origamis.html#surface_dynamics.flat_surfaces.origamis.origami_database.stratum_to_data">[docs]</a><span class="k">def</span> <span class="nf">stratum_to_data</span><span class="p">(</span><span class="n">h</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Encode the stratum entry.</span>

<span class="sd">    TESTS::</span>

<span class="sd">        sage: from surface_dynamics import *</span>

<span class="sd">        sage: import surface_dynamics.flat_surfaces.origamis.origami_database as odb</span>
<span class="sd">        sage: h = AbelianStratum(2,0)</span>
<span class="sd">        sage: s = odb.stratum_to_data(h)</span>
<span class="sd">        sage: isinstance(s,str)</span>
<span class="sd">        True</span>
<span class="sd">        sage: h == odb.data_to_stratum(s)</span>
<span class="sd">        True</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">integer_tuple_to_data</span><span class="p">(</span><span class="n">h</span><span class="o">.</span><span class="n">zeros</span><span class="p">())</span></div>

<div class="viewcode-block" id="data_to_stratum"><a class="viewcode-back" href="../../../../origamis.html#surface_dynamics.flat_surfaces.origamis.origami_database.data_to_stratum">[docs]</a><span class="k">def</span> <span class="nf">data_to_stratum</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Convert a string into a stratum.</span>

<span class="sd">    For encoding convention, see `meth:stratum_to_data`.</span>

<span class="sd">    EXAMPLES::</span>

<span class="sd">        sage: import surface_dynamics.flat_surfaces.origamis.origami_database as odb</span>
<span class="sd">        sage: odb.data_to_stratum(&#39;f f 2&#39;)</span>
<span class="sd">        H_17(15^2, 2)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">AbelianStratum</span><span class="p">(</span><span class="n">data_to_integer_tuple</span><span class="p">(</span><span class="n">s</span><span class="p">))</span></div>


<span class="n">L_exp_approx_to_data</span> <span class="o">=</span> <span class="n">real_tuple_to_data</span>
<span class="n">data_to_L_exp_approx</span> <span class="o">=</span> <span class="n">data_to_real_tuple</span>

<span class="n">pole_partition_to_data</span> <span class="o">=</span> <span class="n">small_positive_integer_tuple_to_data</span>


<div class="viewcode-block" id="data_to_pole_partition"><a class="viewcode-back" href="../../../../origamis.html#surface_dynamics.flat_surfaces.origamis.origami_database.data_to_pole_partition">[docs]</a><span class="k">def</span> <span class="nf">data_to_pole_partition</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    TESTS::</span>

<span class="sd">        sage: import surface_dynamics.flat_surfaces.origamis.origami_database as odb</span>
<span class="sd">        sage: odb.data_to_pole_partition(&#39;0aFe&#39;)</span>
<span class="sd">        (0, 10, 15, 14)</span>
<span class="sd">        sage: odb.data_to_pole_partition(&#39;&#39;) is None</span>
<span class="sd">        True</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">s</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">data_to_small_positive_integer_tuple</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
    <span class="k">return</span> <span class="kc">None</span></div>


<div class="viewcode-block" id="format_pole_partition"><a class="viewcode-back" href="../../../../origamis.html#surface_dynamics.flat_surfaces.origamis.origami_database.format_pole_partition">[docs]</a><span class="k">def</span> <span class="nf">format_pole_partition</span><span class="p">(</span><span class="n">p</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Format into a nice readable string the pole partition.</span>

<span class="sd">    EXAMPLES::</span>

<span class="sd">        sage: import surface_dynamics.flat_surfaces.origamis.origami_database as odb</span>
<span class="sd">        sage: s = odb.pole_partition_to_data((0,3,5,1))</span>
<span class="sd">        sage: odb.format_pole_partition(s)</span>
<span class="sd">        &#39;0 (3,5,1)&#39;</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">data_to_pole_partition</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">p</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;&quot;</span>
    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="o">==</span> <span class="mi">4</span>
    <span class="k">return</span> <span class="s2">&quot;</span><span class="si">%d</span><span class="s2"> (</span><span class="si">%d</span><span class="s2">,</span><span class="si">%d</span><span class="s2">,</span><span class="si">%d</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="n">p</span></div>


<span class="n">nb_cyls_spectrum_to_data</span> <span class="o">=</span> <span class="n">integer_tuple_to_data</span>
<span class="n">data_to_nb_cyls_spectrum</span> <span class="o">=</span> <span class="n">data_to_integer_tuple</span>

<span class="n">sum_of_L_exp_to_data</span> <span class="o">=</span> <span class="n">rational_to_data</span>
<span class="n">data_to_sum_of_L_exp</span> <span class="o">=</span> <span class="n">data_to_rational</span>


<div class="viewcode-block" id="orientation_stratum_to_data"><a class="viewcode-back" href="../../../../origamis.html#surface_dynamics.flat_surfaces.origamis.origami_database.orientation_stratum_to_data">[docs]</a><span class="k">def</span> <span class="nf">orientation_stratum_to_data</span><span class="p">(</span><span class="n">q</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    TESTS::</span>

<span class="sd">        sage: from surface_dynamics import *</span>
<span class="sd">        sage: import surface_dynamics.flat_surfaces.origamis.origami_database as odb</span>
<span class="sd">        sage: q = QuadraticStratum(2,2,0,-1,-1,-1,-1)</span>
<span class="sd">        sage: s = odb.orientation_stratum_to_data(q)</span>
<span class="sd">        sage: isinstance(s,str)</span>
<span class="sd">        True</span>
<span class="sd">        sage: q == odb.data_to_orientation_stratum(s)</span>
<span class="sd">        True</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">q</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="s1">&#39;&#39;</span>
    <span class="k">return</span> <span class="n">integer_tuple_to_data</span><span class="p">(</span><span class="n">q</span><span class="o">.</span><span class="n">zeros</span><span class="p">())</span></div>

<div class="viewcode-block" id="data_to_orientation_stratum"><a class="viewcode-back" href="../../../../origamis.html#surface_dynamics.flat_surfaces.origamis.origami_database.data_to_orientation_stratum">[docs]</a><span class="k">def</span> <span class="nf">data_to_orientation_stratum</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">s</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">QuadraticStratum</span><span class="p">(</span><span class="n">data_to_integer_tuple</span><span class="p">(</span><span class="n">s</span><span class="p">))</span>
    <span class="k">return</span> <span class="kc">None</span></div>


<span class="n">cc_from_name</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">((</span><span class="n">cc</span><span class="o">.</span><span class="n">_name</span><span class="p">,</span> <span class="n">cc</span><span class="p">)</span> <span class="k">for</span> <span class="n">cc</span> <span class="ow">in</span> <span class="p">[</span><span class="n">ASC</span><span class="p">,</span><span class="n">HypASC</span><span class="p">,</span><span class="n">NonHypASC</span><span class="p">,</span><span class="n">EvenASC</span><span class="p">,</span> <span class="n">OddASC</span><span class="p">])</span>

<span class="c1">#</span>
<span class="c1"># db and queries</span>
<span class="c1">#</span>

<div class="viewcode-block" id="EnhancedSQLQuery"><a class="viewcode-back" href="../../../../origamis.html#surface_dynamics.flat_surfaces.origamis.origami_database.EnhancedSQLQuery">[docs]</a><span class="k">class</span> <span class="nc">EnhancedSQLQuery</span><span class="p">(</span><span class="n">SQLQuery</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">query_string</span><span class="p">,</span> <span class="n">database</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        A query for a OrigamiDatabase.</span>

<span class="sd">        INPUT:</span>

<span class="sd">        - ``database`` - the OrigamiDatabase instance to query</span>
<span class="sd">          (if None then a new instance is created)</span>

<span class="sd">        - ``query_string`` - a string representing the SQL</span>
<span class="sd">          query</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">database</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">database</span> <span class="o">=</span> <span class="n">OrigamiDatabase</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">database</span><span class="p">,</span> <span class="n">OrigamiDatabase</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> is not a valid origami database&#39;</span><span class="o">%</span><span class="n">database</span><span class="p">)</span>
        <span class="n">SQLQuery</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">database</span><span class="p">,</span><span class="n">query_string</span><span class="p">)</span></div>


<div class="viewcode-block" id="OrigamiQuery"><a class="viewcode-back" href="../../../../origamis.html#surface_dynamics.flat_surfaces.origamis.origami_database.OrigamiQuery">[docs]</a><span class="k">class</span> <span class="nc">OrigamiQuery</span><span class="p">:</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Origami database query.</span>

<span class="sd">    A query for an instance of OrigamiDatabase. This class nicely wraps the</span>
<span class="sd">    SQLQuery class located in surface_dynamics.databases.database.py to make the query</span>
<span class="sd">    constraints intuitive and with as many pre-definitions as possible. (i.e.:</span>
<span class="sd">    since it has to be a OrigamiDatabase, we already know the table structure</span>
<span class="sd">    and types; and since it is immutable, we can treat these as a guarantee).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">db</span><span class="p">,</span> <span class="n">query_string</span><span class="p">,</span> <span class="n">cols</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        INPUT:</span>

<span class="sd">        - ``origami_db`` - The OrigamiDatabase instance to apply</span>
<span class="sd">          the query to. (If None, then a new instance is created).</span>

<span class="sd">        - ``cols`` - A list of column names (strings)</span>
<span class="sd">          to display in the result when running or showing a query.</span>

<span class="sd">        - ``query_string`` - A string associated to a query (allow =, &lt;=, &lt;, AND</span>
<span class="sd">          OR NOT). It consists only of the part of the SQL statement which</span>
<span class="sd">          appear after the &#39;WHERE&#39; directive.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_cols</span> <span class="o">=</span> <span class="n">cols</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_query_string</span> <span class="o">=</span> <span class="n">query_string</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_display_options</span> <span class="o">=</span> <span class="n">kwds</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_order</span> <span class="o">=</span> <span class="p">[(</span><span class="s2">&quot;nb_squares&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)]</span>

        <span class="k">if</span> <span class="n">db</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_db</span> <span class="o">=</span> <span class="n">OrigamiDatabase</span><span class="p">()</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="n">OrigamiDatabase</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> is not a valid origami database&quot;</span> <span class="o">%</span> <span class="n">db</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_db</span> <span class="o">=</span> <span class="n">db</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        String representation.</span>

<span class="sd">        EXAMPLES::</span>

<span class="sd">            sage: from surface_dynamics import *</span>

<span class="sd">            sage: O = OrigamiDatabase()</span>
<span class="sd">            sage: O.query((&quot;nb_squares&quot;,&quot;=&quot;,5))</span>
<span class="sd">            Origami query: SELECT representative FROM origamis WHERE nb_squares=5 ORDER BY nb_squares ASC</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="s1">&#39;Origami query: </span><span class="si">%s</span><span class="s1">&#39;</span><span class="o">%</span><span class="bp">self</span><span class="o">.</span><span class="n">get_query_string</span><span class="p">()</span>

<div class="viewcode-block" id="OrigamiQuery.database"><a class="viewcode-back" href="../../../../origamis.html#surface_dynamics.flat_surfaces.origamis.origami_database.OrigamiQuery.database">[docs]</a>    <span class="k">def</span> <span class="nf">database</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the database of that query.</span>

<span class="sd">        EXAMPLES::</span>

<span class="sd">            sage: from surface_dynamics import *</span>

<span class="sd">            sage: D = OrigamiDatabase()</span>
<span class="sd">            sage: q = D.query(stratum=AbelianStratum(6))</span>
<span class="sd">            sage: q.database()</span>
<span class="sd">            Database of origamis</span>
<span class="sd">            sage: q.database() is D</span>
<span class="sd">            True</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_db</span></div>

<div class="viewcode-block" id="OrigamiQuery.cols"><a class="viewcode-back" href="../../../../origamis.html#surface_dynamics.flat_surfaces.origamis.origami_database.OrigamiQuery.cols">[docs]</a>    <span class="k">def</span> <span class="nf">cols</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">cols</span><span class="p">):</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get or modify columns.</span>

<span class="sd">        In a sql query, it corresponds to the clause &#39;SELECT&#39;.</span>

<span class="sd">        EXAMPLES::</span>

<span class="sd">            sage: from surface_dynamics import *</span>

<span class="sd">            sage: O = OrigamiDatabase()</span>
<span class="sd">            sage: q = O.query()</span>
<span class="sd">            sage: q.cols()</span>
<span class="sd">            [&#39;representative&#39;]</span>
<span class="sd">            sage: q.cols(&quot;nb_squares&quot;)</span>
<span class="sd">            sage: q.cols()</span>
<span class="sd">            [&#39;nb_squares&#39;]</span>
<span class="sd">            sage: q.cols(&quot;veech_group_index&quot;,&quot;primitive&quot;)</span>
<span class="sd">            sage: q.cols()</span>
<span class="sd">            [&#39;veech_group_index&#39;, &#39;primitive&#39;]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">cols</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cols</span><span class="p">[:]</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">cols</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">cols</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span><span class="nb">tuple</span><span class="p">)):</span>
            <span class="n">cols</span> <span class="o">=</span> <span class="n">cols</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">cols</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">cols</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;*&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_cols</span> <span class="o">=</span> <span class="n">ORIGAMI_DB_cols</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">assert</span> <span class="nb">all</span><span class="p">(</span><span class="n">c</span> <span class="ow">in</span> <span class="n">ORIGAMI_DB_cols</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">cols</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_cols</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">cols</span><span class="p">)</span></div>

<div class="viewcode-block" id="OrigamiQuery.order"><a class="viewcode-back" href="../../../../origamis.html#surface_dynamics.flat_surfaces.origamis.origami_database.OrigamiQuery.order">[docs]</a>    <span class="k">def</span> <span class="nf">order</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get or modify order.</span>

<span class="sd">        Order should be a list (col_name, +1) or (col_name, -1). First one means</span>
<span class="sd">        ascending and the second one descending. In a sql query, it corresponds</span>
<span class="sd">        to the clause &#39;ORDER BY&#39;.</span>

<span class="sd">        EXAMPLES::</span>

<span class="sd">            sage: from surface_dynamics import *</span>

<span class="sd">            sage: O = OrigamiDatabase()</span>
<span class="sd">            sage: q = O.query()</span>
<span class="sd">            sage: q.order((&quot;nb_squares&quot;,1),(&quot;pole_partition&quot;,1))</span>
<span class="sd">            sage: q.get_query_string()</span>
<span class="sd">            &#39;SELECT representative FROM origamis ORDER BY nb_squares ASC,pole_partition ASC&#39;</span>
<span class="sd">            sage: q.order((&quot;nb_squares&quot;,-1))</span>
<span class="sd">            sage: q.get_query_string()</span>
<span class="sd">            &#39;SELECT representative FROM origamis ORDER BY nb_squares DESC&#39;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">args</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_order</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="n">args</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="n">tt</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">args</span><span class="p">:</span>
            <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="nb">tuple</span><span class="p">)</span>
            <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span>
            <span class="k">assert</span> <span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="n">ORIGAMI_DB_cols</span>
            <span class="k">assert</span> <span class="n">t</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">or</span> <span class="n">t</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span>
            <span class="n">tt</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="nb">int</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="mi">1</span><span class="p">])))</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">tt</span><span class="p">))</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">tt</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;duplicate in your list&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_order</span> <span class="o">=</span> <span class="n">tt</span></div>

<div class="viewcode-block" id="OrigamiQuery.get_query_string"><a class="viewcode-back" href="../../../../origamis.html#surface_dynamics.flat_surfaces.origamis.origami_database.OrigamiQuery.get_query_string">[docs]</a>    <span class="k">def</span> <span class="nf">get_query_string</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Output the query string in sql format.</span>

<span class="sd">        This is the method where the attribute of this object are translated</span>
<span class="sd">        into a sql query.</span>

<span class="sd">        EXAMPLES::</span>

<span class="sd">            sage: from surface_dynamics import *</span>

<span class="sd">            sage: D = OrigamiDatabase()</span>
<span class="sd">            sage: q = D.query((&#39;stratum&#39;,&#39;=&#39;,AbelianStratum(1,1)), (&#39;nb_squares&#39;,&#39;&lt;&#39;, 13))</span>
<span class="sd">            sage: q.get_query_string()</span>
<span class="sd">            &quot;SELECT representative FROM origamis WHERE stratum=&#39;1 1&#39; AND nb_squares&lt;13 ORDER BY nb_squares ASC&quot;</span>
<span class="sd">            sage: q.order((&quot;nb_squares&quot;,1),(&quot;pole_partition&quot;,-1))</span>
<span class="sd">            sage: q.get_query_string()</span>
<span class="sd">            &quot;SELECT representative FROM origamis WHERE stratum=&#39;1 1&#39; AND nb_squares&lt;13 ORDER BY nb_squares ASC,pole_partition DESC&quot;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">query</span> <span class="o">=</span> <span class="s1">&#39;SELECT &#39;</span> <span class="o">+</span> <span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_cols</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; FROM origamis&#39;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_query_string</span><span class="p">:</span>
            <span class="n">query</span> <span class="o">+=</span> <span class="s1">&#39; WHERE &#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_query_string</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_order</span><span class="p">:</span>
            <span class="n">d</span> <span class="o">=</span> <span class="p">{</span><span class="mi">1</span><span class="p">:</span> <span class="s1">&#39; ASC&#39;</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span> <span class="s1">&#39; DESC&#39;</span><span class="p">}</span>
            <span class="n">query</span> <span class="o">+=</span> <span class="s2">&quot; ORDER BY &quot;</span> <span class="o">+</span> <span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">col_name</span> <span class="o">+</span> <span class="n">d</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">col_name</span><span class="p">,</span><span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_order</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">query</span></div>

<div class="viewcode-block" id="OrigamiQuery.sql_query"><a class="viewcode-back" href="../../../../origamis.html#surface_dynamics.flat_surfaces.origamis.origami_database.OrigamiQuery.sql_query">[docs]</a>    <span class="k">def</span> <span class="nf">sql_query</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the SQLQuery.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">SQLQuery</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_db</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_query_string</span><span class="p">())</span></div>

    <span class="k">def</span> <span class="fm">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Iterate through the results of self.</span>

<span class="sd">        The function essentially wraps the iteration of SQLQuery in order to</span>
<span class="sd">        perform some data conversion.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">db</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_db</span>
        <span class="k">for</span> <span class="n">result</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sql_query</span><span class="p">():</span>
            <span class="n">r</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">j</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_cols</span><span class="p">,</span><span class="n">result</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">db</span><span class="o">.</span><span class="n">_data_to_entry</span><span class="p">:</span>
                    <span class="n">r</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">_data_to_entry</span><span class="p">[</span><span class="n">i</span><span class="p">](</span><span class="n">j</span><span class="p">))</span>
                <span class="k">elif</span> <span class="n">ORIGAMI_DB_skeleton</span><span class="p">[</span><span class="s1">&#39;origamis&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;sql&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;BOOLEAN&#39;</span><span class="p">:</span>
                    <span class="n">r</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">eval</span><span class="p">(</span><span class="n">j</span><span class="p">))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">r</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">j</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">r</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">yield</span> <span class="n">r</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">yield</span> <span class="n">r</span>

<div class="viewcode-block" id="OrigamiQuery.list"><a class="viewcode-back" href="../../../../origamis.html#surface_dynamics.flat_surfaces.origamis.origami_database.OrigamiQuery.list">[docs]</a>    <span class="k">def</span> <span class="nf">list</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the list of entries of the query.</span>

<span class="sd">        The output is either a list of objects if there is only one column for</span>
<span class="sd">        that query. Otherwise, it is a list of lists where each item is the</span>
<span class="sd">        entries of columns.</span>

<span class="sd">        See also `meth:dict` to get a dictionary output.</span>

<span class="sd">        EXAMPLES::</span>

<span class="sd">            sage: from surface_dynamics import *</span>

<span class="sd">            sage: S = OrigamiDatabase(read_only=False)</span>
<span class="sd">            sage: q = S.query((&#39;stratum&#39;,&#39;=&#39;,AbelianStratum(1,1)),(&#39;nb_squares&#39;,&#39;=&#39;,6))</span>
<span class="sd">            sage: q.list()</span>
<span class="sd">            [(1)(2)(3,4,5,6)</span>
<span class="sd">            (1,2,3)(4,5,6), (1)(2)(3)(4,5,6)</span>
<span class="sd">            (1,2,3,4)(5,6), (1)(2)(3,4)(5)(6)</span>
<span class="sd">            (1,2,3)(4,5,6), (1)(2)(3)(4,5)(6)</span>
<span class="sd">            (1,2,3,4)(5,6), (1)(2,3)(4,5)(6)</span>
<span class="sd">            (1,2,4)(3,5,6)]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></div>

<div class="viewcode-block" id="OrigamiQuery.dict"><a class="viewcode-back" href="../../../../origamis.html#surface_dynamics.flat_surfaces.origamis.origami_database.OrigamiQuery.dict">[docs]</a>    <span class="k">def</span> <span class="nf">dict</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns a list of dictionaries: col -&gt; value.</span>

<span class="sd">        EXAMPLES::</span>

<span class="sd">            sage: from surface_dynamics import *</span>

<span class="sd">            sage: D = OrigamiDatabase()</span>
<span class="sd">            sage: q = D.query(stratum=AbelianStratum(1,1), nb_squares=8)</span>
<span class="sd">            sage: q.cols(&#39;teich_curve_genus&#39;)</span>
<span class="sd">            sage: q.dict()</span>
<span class="sd">            [{&#39;teich_curve_genus&#39;: 1},</span>
<span class="sd">             {&#39;teich_curve_genus&#39;: 1},</span>
<span class="sd">             {&#39;teich_curve_genus&#39;: 0},</span>
<span class="sd">             {&#39;teich_curve_genus&#39;: 0}]</span>

<span class="sd">            sage: q.cols(&#39;pole_partition&#39;, &#39;primitive&#39;)</span>
<span class="sd">            sage: q.dict()</span>
<span class="sd">            [{&#39;pole_partition&#39;: (0, 2, 2, 2), &#39;primitive&#39;: True},</span>
<span class="sd">             {&#39;pole_partition&#39;: (2, 0, 2, 2), &#39;primitive&#39;: True},</span>
<span class="sd">             {&#39;pole_partition&#39;: (0, 0, 2, 4), &#39;primitive&#39;: False},</span>
<span class="sd">             {&#39;pole_partition&#39;: (0, 0, 2, 4), &#39;primitive&#39;: False}]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_cols</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[{</span><span class="bp">self</span><span class="o">.</span><span class="n">_cols</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span> <span class="n">x</span><span class="p">}</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[</span><span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_cols</span><span class="p">,</span> <span class="n">x</span><span class="p">))</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">]</span></div>

<div class="viewcode-block" id="OrigamiQuery.number_of"><a class="viewcode-back" href="../../../../origamis.html#surface_dynamics.flat_surfaces.origamis.origami_database.OrigamiQuery.number_of">[docs]</a>    <span class="k">def</span> <span class="nf">number_of</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the number of entries in the database that satisfy the</span>
<span class="sd">        query.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">sum</span><span class="p">(</span><span class="mi">1</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">)</span></div>

    <span class="fm">__len__</span> <span class="o">=</span> <span class="n">number_of</span>

<div class="viewcode-block" id="OrigamiQuery.show"><a class="viewcode-back" href="../../../../origamis.html#surface_dynamics.flat_surfaces.origamis.origami_database.OrigamiQuery.show">[docs]</a>    <span class="k">def</span> <span class="nf">show</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">opts</span><span class="p">):</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Output a text array with the results of that query.</span>

<span class="sd">        EXAMPLES::</span>

<span class="sd">            sage: from surface_dynamics import *</span>

<span class="sd">        There is a problem with show method the SQLQuery::</span>

<span class="sd">            sage: O = OrigamiDatabase()</span>
<span class="sd">            sage: q = O.query((&quot;nb_squares&quot;,&quot;=&quot;,6))</span>
<span class="sd">            sage: q.cols((&quot;stratum&quot;,&quot;sum_of_L_exp&quot;,&quot;L_exp_approx&quot;))</span>
<span class="sd">            sage: q.show()</span>
<span class="sd">            Stratum              Sum of L exp         L exp approx</span>
<span class="sd">            ------------------------------------------------------------</span>
<span class="sd">            ...</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">opts</span><span class="p">[</span><span class="s1">&#39;format_cols&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_db</span><span class="o">.</span><span class="n">_get_format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_cols</span><span class="p">)</span>
        <span class="n">opts</span><span class="p">[</span><span class="s1">&#39;relabel_cols&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">relabel_cols</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">sql_query</span><span class="p">()</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="o">**</span><span class="n">opts</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="build_local_data"><a class="viewcode-back" href="../../../../origamis.html#surface_dynamics.flat_surfaces.origamis.origami_database.build_local_data">[docs]</a><span class="k">def</span> <span class="nf">build_local_data</span><span class="p">(</span><span class="n">o</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Build local data for the origami ``o``.</span>

<span class="sd">    The output is a dictionary that is intended to be used to feed the database</span>
<span class="sd">    of origamis. The local data are geometrical aspects (stratum, genus, ...) the</span>
<span class="sd">    monodromy group (primitivity, orientation cover, ...) and the automorphisms</span>
<span class="sd">    of ``o``.</span>

<span class="sd">    See also :func:`build_lyapunov_exponents` to construct Lyapunov exponents</span>
<span class="sd">    and :func:`build_global_data`.</span>

<span class="sd">    EXAMPLES::</span>

<span class="sd">        sage: from surface_dynamics import *</span>

<span class="sd">        sage: o = Origami(&#39;(1,2)&#39;,&#39;(1,3)&#39;)</span>
<span class="sd">        sage: import surface_dynamics.flat_surfaces.origamis.origami_database as odb</span>
<span class="sd">        sage: data = odb.build_local_data(o)  # optional: gap_packages</span>
<span class="sd">        sage: data[&#39;stratum&#39;]                 # optional: gap_packages</span>
<span class="sd">        H_2(2)</span>
<span class="sd">        sage: data[&#39;nb_squares&#39;]              # optional: gap_packages</span>
<span class="sd">        3</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">from</span> <span class="nn">sage.functions.other</span> <span class="kn">import</span> <span class="n">factorial</span>
    <span class="kn">from</span> <span class="nn">sage.libs.gap.libgap</span> <span class="kn">import</span> <span class="n">libgap</span>

    <span class="n">data</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="n">data</span><span class="p">[</span><span class="s1">&#39;representative&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">o</span>

    <span class="n">data</span><span class="p">[</span><span class="s1">&#39;stratum&#39;</span><span class="p">]</span>    <span class="o">=</span> <span class="n">o</span><span class="o">.</span><span class="n">stratum</span><span class="p">()</span>
    <span class="n">data</span><span class="p">[</span><span class="s1">&#39;component&#39;</span><span class="p">]</span>  <span class="o">=</span> <span class="n">o</span><span class="o">.</span><span class="n">stratum_component</span><span class="p">()</span><span class="o">.</span><span class="n">_name</span>
    <span class="n">data</span><span class="p">[</span><span class="s1">&#39;genus&#39;</span><span class="p">]</span>      <span class="o">=</span> <span class="n">o</span><span class="o">.</span><span class="n">genus</span><span class="p">()</span>
    <span class="n">data</span><span class="p">[</span><span class="s1">&#39;nb_squares&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">o</span><span class="o">.</span><span class="n">nb_squares</span><span class="p">()</span>

    <span class="n">G</span> <span class="o">=</span> <span class="n">o</span><span class="o">.</span><span class="n">monodromy</span><span class="p">()</span>
    <span class="n">data</span><span class="p">[</span><span class="s1">&#39;monodromy_order&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">G</span><span class="o">.</span><span class="n">order</span><span class="p">()</span>
    <span class="n">data</span><span class="p">[</span><span class="s1">&#39;monodromy_index&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">factorial</span><span class="p">(</span><span class="n">o</span><span class="o">.</span><span class="n">nb_squares</span><span class="p">())</span> <span class="o">/</span> <span class="n">G</span><span class="o">.</span><span class="n">order</span><span class="p">()</span>
    <span class="n">data</span><span class="p">[</span><span class="s1">&#39;monodromy_signature&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">o</span><span class="o">.</span><span class="n">r</span><span class="p">()</span><span class="o">.</span><span class="n">sign</span><span class="p">()</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span> <span class="ow">or</span> <span class="n">o</span><span class="o">.</span><span class="n">u</span><span class="p">()</span><span class="o">.</span><span class="n">sign</span><span class="p">()</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span>
    <span class="n">data</span><span class="p">[</span><span class="s1">&#39;monodromy_solvable&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">G</span><span class="o">.</span><span class="n">is_solvable</span><span class="p">()</span>
    <span class="n">data</span><span class="p">[</span><span class="s1">&#39;monodromy_nilpotent&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">G</span><span class="o">.</span><span class="n">is_nilpotent</span><span class="p">()</span>

    <span class="n">primitive</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;primitive&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">o</span><span class="o">.</span><span class="n">is_primitive</span><span class="p">()</span>
    <span class="n">quasi_primitive</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;quasi_primitive&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">o</span><span class="o">.</span><span class="n">is_quasi_primitive</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">primitive</span><span class="p">:</span>
        <span class="n">data</span><span class="p">[</span><span class="s1">&#39;automorphism_group_order&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">data</span><span class="p">[</span><span class="s1">&#39;automorphism_group_name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;1&#39;</span>
        <span class="n">data</span><span class="p">[</span><span class="s1">&#39;regular&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;quasi_regular&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">data</span><span class="p">[</span><span class="s1">&#39;monodromy_name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">libgap</span><span class="o">.</span><span class="n">StructureDescription</span><span class="p">(</span><span class="n">G</span><span class="p">)</span>
        <span class="n">data</span><span class="p">[</span><span class="s1">&#39;optimal_degree&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">o</span><span class="o">.</span><span class="n">nb_squares</span><span class="p">()</span>

        <span class="n">d</span> <span class="o">=</span> <span class="n">o</span><span class="o">.</span><span class="n">orientation_data</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">d</span><span class="p">:</span>
            <span class="n">data</span><span class="p">[</span><span class="s1">&#39;orientation_cover&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">data</span><span class="p">[</span><span class="s1">&#39;minus_identity_invariant&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">d</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span>
            <span class="n">d</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">data</span><span class="p">[</span><span class="s1">&#39;orientation_stratum&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">data</span><span class="p">[</span><span class="s1">&#39;orientation_genus&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">genus</span><span class="p">()</span>
            <span class="n">data</span><span class="p">[</span><span class="s1">&#39;hyperelliptic&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">genus</span><span class="p">()</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
            <span class="n">p0</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">p1</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
            <span class="n">data</span><span class="p">[</span><span class="s1">&#39;pole_partition&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">p0</span><span class="p">,</span><span class="n">p1</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">p1</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">p1</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">data</span><span class="p">[</span><span class="s1">&#39;orientation_cover&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;hyperelliptic&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="n">data</span><span class="p">[</span><span class="s1">&#39;pole_partition&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;orientation_stratum&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;orientation_genus&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="n">G</span><span class="o">.</span><span class="n">order</span><span class="p">()</span> <span class="o">&lt;</span> <span class="mi">2500</span><span class="p">:</span>
            <span class="n">data</span><span class="p">[</span><span class="s1">&#39;monodromy_gap_primitive_id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">libgap</span><span class="o">.</span><span class="n">PrimitiveIdentification</span><span class="p">(</span><span class="n">G</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">data</span><span class="p">[</span><span class="s1">&#39;monodromy_gap_primitive_id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="n">data</span><span class="p">[</span><span class="s1">&#39;relative_monodromy_order&#39;</span><span class="p">]</span>     <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;monodromy_order&#39;</span><span class="p">]</span>
        <span class="n">data</span><span class="p">[</span><span class="s1">&#39;relative_monodromy_index&#39;</span><span class="p">]</span>     <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;monodromy_index&#39;</span><span class="p">]</span>
        <span class="n">data</span><span class="p">[</span><span class="s1">&#39;relative_monodromy_signature&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;monodromy_signature&#39;</span><span class="p">]</span>
        <span class="n">data</span><span class="p">[</span><span class="s1">&#39;relative_monodromy_solvable&#39;</span><span class="p">]</span>  <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;monodromy_solvable&#39;</span><span class="p">]</span>
        <span class="n">data</span><span class="p">[</span><span class="s1">&#39;relative_monodromy_nilpotent&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;monodromy_nilpotent&#39;</span><span class="p">]</span>
        <span class="n">data</span><span class="p">[</span><span class="s1">&#39;relative_monodromy_name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;monodromy_name&#39;</span><span class="p">]</span>
        <span class="n">data</span><span class="p">[</span><span class="s1">&#39;relative_monodromy_gap_primitive_id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;monodromy_gap_primitive_id&#39;</span><span class="p">]</span>

    <span class="k">else</span><span class="p">:</span>  <span class="c1"># not primitive</span>
        <span class="n">data</span><span class="p">[</span><span class="s1">&#39;monodromy_name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;monodromy_gap_primitive_id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="n">H</span> <span class="o">=</span> <span class="n">o</span><span class="o">.</span><span class="n">monodromy</span><span class="p">(</span><span class="n">relative</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">data</span><span class="p">[</span><span class="s1">&#39;relative_monodromy_order&#39;</span><span class="p">]</span>     <span class="o">=</span> <span class="n">H</span><span class="o">.</span><span class="n">order</span><span class="p">()</span>
        <span class="n">data</span><span class="p">[</span><span class="s1">&#39;relative_monodromy_index&#39;</span><span class="p">]</span>     <span class="o">=</span> <span class="n">factorial</span><span class="p">(</span><span class="n">o</span><span class="o">.</span><span class="n">optimal_degree</span><span class="p">())</span> <span class="o">/</span> <span class="n">H</span><span class="o">.</span><span class="n">order</span><span class="p">()</span>
        <span class="n">data</span><span class="p">[</span><span class="s1">&#39;relative_monodromy_signature&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">any</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">sign</span><span class="p">()</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span> <span class="k">for</span> <span class="n">g</span> <span class="ow">in</span> <span class="n">H</span><span class="o">.</span><span class="n">gens</span><span class="p">())</span>
        <span class="n">data</span><span class="p">[</span><span class="s1">&#39;relative_monodromy_solvable&#39;</span><span class="p">]</span>  <span class="o">=</span> <span class="n">H</span><span class="o">.</span><span class="n">is_solvable</span><span class="p">()</span>
        <span class="n">data</span><span class="p">[</span><span class="s1">&#39;relative_monodromy_nilpotent&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">H</span><span class="o">.</span><span class="n">is_nilpotent</span><span class="p">()</span>
        <span class="n">data</span><span class="p">[</span><span class="s1">&#39;relative_monodromy_gap_primitive_id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">libgap</span><span class="o">.</span><span class="n">PrimitiveIdentification</span><span class="p">(</span><span class="n">H</span><span class="p">)</span> <span class="k">if</span> <span class="n">H</span><span class="o">.</span><span class="n">order</span><span class="p">()</span> <span class="o">&lt;</span> <span class="mi">2500</span> <span class="k">else</span> <span class="kc">None</span>
        <span class="n">data</span><span class="p">[</span><span class="s1">&#39;relative_monodromy_name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">libgap</span><span class="o">.</span><span class="n">StructureDescription</span><span class="p">(</span><span class="n">H</span><span class="p">)</span> <span class="k">if</span> <span class="n">quasi_primitive</span> <span class="k">else</span> <span class="kc">None</span>

        <span class="n">a</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">u</span> <span class="o">=</span> <span class="n">o</span><span class="o">.</span><span class="n">lattice_of_absolute_periods</span><span class="p">()</span>
        <span class="n">data</span><span class="p">[</span><span class="s1">&#39;optimal_degree&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">a</span> <span class="o">*</span> <span class="n">u</span>

        <span class="n">A</span> <span class="o">=</span> <span class="n">o</span><span class="o">.</span><span class="n">automorphism_group</span><span class="p">()</span>
        <span class="n">d</span> <span class="o">=</span> <span class="n">o</span><span class="o">.</span><span class="n">orientation_data</span><span class="p">()</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">d</span><span class="p">:</span>
            <span class="n">data</span><span class="p">[</span><span class="s1">&#39;orientation_cover&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="n">data</span><span class="p">[</span><span class="s1">&#39;orientation_stratum&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;orientation_genus&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;pole_partition&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">data</span><span class="p">[</span><span class="s1">&#39;orientation_genus&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">data</span><span class="p">[</span><span class="s1">&#39;hyperelliptic&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="k">elif</span> <span class="n">A</span><span class="o">.</span><span class="n">order</span><span class="p">()</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">data</span><span class="p">[</span><span class="s1">&#39;orientation_cover&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">data</span><span class="p">[</span><span class="s1">&#39;orientation_stratum&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">data</span><span class="p">[</span><span class="s1">&#39;orientation_genus&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">genus</span><span class="p">()</span>
            <span class="n">data</span><span class="p">[</span><span class="s1">&#39;hyperelliptic&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">genus</span><span class="p">()</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
            <span class="n">data</span><span class="p">[</span><span class="s1">&#39;minus_identity_invariant&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">p0</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">p1</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">2</span><span class="p">])</span>
            <span class="n">data</span><span class="p">[</span><span class="s1">&#39;pole_partition&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">p0</span><span class="p">,</span><span class="n">p1</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">p1</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">p1</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">data</span><span class="p">[</span><span class="s1">&#39;orientation_cover&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">data</span><span class="p">[</span><span class="s1">&#39;orientation_stratum&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;orientation_genus&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;pole_partition&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">data</span><span class="p">[</span><span class="s1">&#39;hyperelliptic&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">any</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">genus</span><span class="p">()</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">d</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;hyperelliptic&#39;</span><span class="p">]:</span>
                <span class="n">dd</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">genus</span><span class="p">()</span> <span class="o">==</span> <span class="mi">0</span><span class="p">,</span> <span class="n">d</span><span class="p">))</span>
                <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">dd</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span>
                <span class="n">dd</span> <span class="o">=</span> <span class="n">dd</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">p0</span> <span class="o">=</span> <span class="n">dd</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
                <span class="n">p1</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">dd</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
                <span class="n">data</span><span class="p">[</span><span class="s1">&#39;pole_partition&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">p0</span><span class="p">,</span><span class="n">p1</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">p1</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">p1</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>

        <span class="k">if</span> <span class="n">o</span><span class="o">.</span><span class="n">is_regular</span><span class="p">():</span>
            <span class="n">data</span><span class="p">[</span><span class="s1">&#39;regular&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;quasi_regular&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">elif</span> <span class="n">o</span><span class="o">.</span><span class="n">is_quasi_regular</span><span class="p">():</span>
            <span class="n">data</span><span class="p">[</span><span class="s1">&#39;regular&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="n">data</span><span class="p">[</span><span class="s1">&#39;quasi_regular&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">data</span><span class="p">[</span><span class="s1">&#39;regular&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;quasi_regular&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="n">data</span><span class="p">[</span><span class="s1">&#39;automorphism_group_order&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">A</span><span class="o">.</span><span class="n">order</span><span class="p">()</span>
        <span class="n">data</span><span class="p">[</span><span class="s1">&#39;automorphism_group_name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">libgap</span><span class="o">.</span><span class="n">StructureDescription</span><span class="p">(</span><span class="n">A</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">data</span></div>

<div class="viewcode-block" id="build_lyapunov_exponents"><a class="viewcode-back" href="../../../../origamis.html#surface_dynamics.flat_surfaces.origamis.origami_database.build_lyapunov_exponents">[docs]</a><span class="k">def</span> <span class="nf">build_lyapunov_exponents</span><span class="p">(</span><span class="n">o</span><span class="p">,</span> <span class="n">nb_iterations</span><span class="o">=</span><span class="mh">0X10000</span><span class="p">,</span> <span class="n">nb_experiments</span><span class="o">=</span><span class="mi">10</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Compute the lyapunov exponents for the origami ``o`` and update the</span>
<span class="sd">    database.</span>

<span class="sd">    EXAMPLES::</span>

<span class="sd">        sage: from surface_dynamics import *</span>

<span class="sd">        sage: o = Origami(&#39;(1,2)&#39;, &#39;(1,3)&#39;)</span>
<span class="sd">        sage: import surface_dynamics.flat_surfaces.origamis.origami_database as odb</span>
<span class="sd">        sage: data = odb.build_lyapunov_exponents(o)</span>
<span class="sd">        sage: data       # abs tol .1</span>
<span class="sd">        {&#39;L_exp_approx&#39;: [0.333348091]}</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">data</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="n">data</span><span class="p">[</span><span class="s1">&#39;L_exp_approx&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">o</span><span class="o">.</span><span class="n">lyapunov_exponents_approx</span><span class="p">(</span>
        <span class="n">nb_iterations</span><span class="o">=</span><span class="n">nb_iterations</span><span class="p">,</span>
        <span class="n">nb_experiments</span><span class="o">=</span><span class="n">nb_experiments</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">data</span></div>


<div class="viewcode-block" id="build_global_data"><a class="viewcode-back" href="../../../../origamis.html#surface_dynamics.flat_surfaces.origamis.origami_database.build_global_data">[docs]</a><span class="k">def</span> <span class="nf">build_global_data</span><span class="p">(</span><span class="n">o</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Compute the global data that are obtained from the Teichmueller curve of the</span>
<span class="sd">    origami ``o``. If the Teichmueller curve ``c`` is not provided, then it is</span>
<span class="sd">    recomputed from scratch (and may be long).</span>

<span class="sd">    EXAMPLES::</span>

<span class="sd">        sage: from surface_dynamics import *</span>

<span class="sd">        sage: o = Origami(&#39;(1,2)&#39;, &#39;(1,3)&#39;)</span>
<span class="sd">        sage: from surface_dynamics.flat_surfaces.origamis.origami_database import build_global_data</span>
<span class="sd">        sage: data = build_global_data(o)</span>
<span class="sd">        sage: for item in sorted(data): print(&quot;%-25s %s&quot; % (item, data[item]))</span>
<span class="sd">        max_hom_dim               2</span>
<span class="sd">        max_nb_of_cyls            2</span>
<span class="sd">        min_hom_dim               1</span>
<span class="sd">        min_nb_of_cyls            1</span>
<span class="sd">        minus_identity_invariant  True</span>
<span class="sd">        sum_of_L_exp              4/3</span>
<span class="sd">        teich_curve_genus         0</span>
<span class="sd">        teich_curve_ncusps        2</span>
<span class="sd">        teich_curve_nu2           1</span>
<span class="sd">        teich_curve_nu3           0</span>
<span class="sd">        veech_group_congruence    True</span>
<span class="sd">        veech_group_index         3</span>
<span class="sd">        veech_group_level         2</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">data</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="k">if</span> <span class="n">c</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">c</span> <span class="o">=</span> <span class="n">o</span><span class="o">.</span><span class="n">teichmueller_curve</span><span class="p">()</span>

    <span class="n">data</span><span class="p">[</span><span class="s1">&#39;minus_identity_invariant&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">o</span><span class="o">.</span><span class="n">inverse</span><span class="p">()</span><span class="o">.</span><span class="n">relabel</span><span class="p">()</span> <span class="ow">in</span> <span class="n">c</span>

    <span class="n">V</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">veech_group</span><span class="p">()</span>
    <span class="n">data</span><span class="p">[</span><span class="s1">&#39;veech_group_index&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">V</span><span class="o">.</span><span class="n">index</span><span class="p">()</span>
    <span class="n">data</span><span class="p">[</span><span class="s1">&#39;veech_group_congruence&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">V</span><span class="o">.</span><span class="n">is_congruence</span><span class="p">()</span>
    <span class="n">data</span><span class="p">[</span><span class="s1">&#39;veech_group_level&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">V</span><span class="o">.</span><span class="n">generalised_level</span><span class="p">()</span>
    <span class="n">data</span><span class="p">[</span><span class="s1">&#39;teich_curve_ncusps&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">V</span><span class="o">.</span><span class="n">ncusps</span><span class="p">()</span>
    <span class="n">data</span><span class="p">[</span><span class="s1">&#39;teich_curve_nu2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">V</span><span class="o">.</span><span class="n">nu2</span><span class="p">()</span>
    <span class="n">data</span><span class="p">[</span><span class="s1">&#39;teich_curve_nu3&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">V</span><span class="o">.</span><span class="n">nu3</span><span class="p">()</span>
    <span class="n">data</span><span class="p">[</span><span class="s1">&#39;teich_curve_genus&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">V</span><span class="o">.</span><span class="n">genus</span><span class="p">()</span>

    <span class="n">s</span> <span class="o">=</span> <span class="mi">0</span>                    <span class="c1"># sum of L. exp (Kontsevich formula)</span>
    <span class="n">m_ncyls</span> <span class="o">=</span> <span class="mi">4</span><span class="o">*</span><span class="n">o</span><span class="o">.</span><span class="n">genus</span><span class="p">()</span><span class="o">+</span><span class="mi">4</span>  <span class="c1"># min. nb cyls</span>
    <span class="n">M_ncyls</span> <span class="o">=</span> <span class="mi">0</span>              <span class="c1"># max. nb cyls</span>
    <span class="n">m_hd</span> <span class="o">=</span> <span class="mi">4</span><span class="o">*</span><span class="n">o</span><span class="o">.</span><span class="n">genus</span><span class="p">()</span><span class="o">+</span><span class="mi">4</span>     <span class="c1"># min. Hom. dim</span>
    <span class="n">M_hd</span> <span class="o">=</span> <span class="mi">0</span>                 <span class="c1"># max. Hom. dim</span>
    <span class="k">for</span> <span class="p">(</span><span class="n">oo</span><span class="p">,</span> <span class="n">l</span><span class="p">)</span> <span class="ow">in</span> <span class="n">c</span><span class="o">.</span><span class="n">cusp_representative_iterator</span><span class="p">():</span>
        <span class="n">cc</span><span class="p">,</span><span class="n">w</span><span class="p">,</span><span class="n">h</span><span class="p">,</span><span class="n">_</span> <span class="o">=</span> <span class="n">oo</span><span class="o">.</span><span class="n">cylinder_diagram</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">nc</span> <span class="o">=</span> <span class="n">cc</span><span class="o">.</span><span class="n">ncyls</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">nc</span> <span class="o">&lt;</span> <span class="n">m_ncyls</span><span class="p">:</span>
            <span class="n">m_ncyls</span> <span class="o">=</span> <span class="n">nc</span>
        <span class="k">if</span> <span class="n">nc</span> <span class="o">&gt;</span> <span class="n">M_ncyls</span><span class="p">:</span>
            <span class="n">M_ncyls</span> <span class="o">=</span> <span class="n">nc</span>
        <span class="n">hd</span> <span class="o">=</span> <span class="n">cc</span><span class="o">.</span><span class="n">homological_dimension_of_cylinders</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">hd</span> <span class="o">&lt;</span> <span class="n">m_hd</span><span class="p">:</span>
            <span class="n">m_hd</span> <span class="o">=</span> <span class="n">hd</span>
        <span class="k">if</span> <span class="n">hd</span> <span class="o">&gt;</span> <span class="n">M_hd</span><span class="p">:</span>
            <span class="n">M_hd</span> <span class="o">=</span> <span class="n">hd</span>
        <span class="k">for</span> <span class="n">j</span><span class="p">,</span><span class="n">bot</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">cc</span><span class="o">.</span><span class="n">bot_cycle_tuples</span><span class="p">()):</span>
            <span class="n">ww</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">w</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">bot</span><span class="p">)</span>
            <span class="n">s</span> <span class="o">+=</span> <span class="n">l</span> <span class="o">*</span> <span class="n">Integer</span><span class="p">(</span><span class="n">h</span><span class="p">[</span><span class="n">j</span><span class="p">])</span> <span class="o">/</span> <span class="n">Integer</span><span class="p">(</span><span class="n">ww</span><span class="p">)</span>

    <span class="n">s</span> <span class="o">/=</span> <span class="n">V</span><span class="o">.</span><span class="n">index</span><span class="p">()</span>
    <span class="n">s</span> <span class="o">+=</span> <span class="n">Integer</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="n">Integer</span><span class="p">(</span><span class="mi">12</span><span class="p">)</span> <span class="o">*</span> <span class="nb">sum</span><span class="p">(</span><span class="n">m</span><span class="o">*</span><span class="p">(</span><span class="n">m</span><span class="o">+</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">m</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">o</span><span class="o">.</span><span class="n">stratum</span><span class="p">()</span><span class="o">.</span><span class="n">zeros</span><span class="p">())</span>

    <span class="n">data</span><span class="p">[</span><span class="s1">&#39;sum_of_L_exp&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">s</span>
    <span class="n">data</span><span class="p">[</span><span class="s1">&#39;min_nb_of_cyls&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">m_ncyls</span>
    <span class="n">data</span><span class="p">[</span><span class="s1">&#39;max_nb_of_cyls&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">M_ncyls</span>
    <span class="n">data</span><span class="p">[</span><span class="s1">&#39;min_hom_dim&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">m_hd</span>
    <span class="n">data</span><span class="p">[</span><span class="s1">&#39;max_hom_dim&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">M_hd</span>

    <span class="k">return</span> <span class="n">data</span></div>


<div class="viewcode-block" id="OrigamiDatabase"><a class="viewcode-back" href="../../../../origamis.html#surface_dynamics.flat_surfaces.origamis.origami_database.OrigamiDatabase">[docs]</a><span class="k">class</span> <span class="nc">OrigamiDatabase</span><span class="p">(</span><span class="n">SQLDatabase</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Database of arithmetic Teichmueller curves.</span>

<span class="sd">    EXAMPLES::</span>

<span class="sd">        sage: from surface_dynamics import *</span>

<span class="sd">    To query the database the main method is meth:`query`::</span>

<span class="sd">        sage: D = OrigamiDatabase()</span>
<span class="sd">        sage: q = D.query(genus=3, nb_squares=12)</span>
<span class="sd">        sage: q.number_of()</span>
<span class="sd">        146</span>
<span class="sd">        sage: l = q.list()</span>
<span class="sd">        sage: o = l[0]</span>
<span class="sd">        sage: o.genus()</span>
<span class="sd">        3</span>
<span class="sd">        sage: o.nb_squares()</span>
<span class="sd">        12</span>

<span class="sd">    For the precise usage of the method query, see the documentation of that</span>
<span class="sd">    function. Here is an example to show how to found the Eierlegende</span>
<span class="sd">    Wollmilchsau in the database from its property of complete degenerate</span>
<span class="sd">    spectrum::</span>

<span class="sd">        sage: q = D.query(sum_of_L_exp=1, stratum=AbelianStratum(1,1,1,1))</span>
<span class="sd">        sage: len(q)</span>
<span class="sd">        1</span>
<span class="sd">        sage: o = q.list()[0]</span>
<span class="sd">        sage: o.is_isomorphic(origamis.EierlegendeWollmilchsau())</span>
<span class="sd">        True</span>

<span class="sd">    We check the classification of arithmetic Teichmueller curves in H(2) from</span>
<span class="sd">    Hubert-Lelievre and McMullen::</span>

<span class="sd">        sage: A = AbelianStratum(2)</span>
<span class="sd">        sage: for n in range(3, 15):</span>
<span class="sd">        ....:     q = D.query(stratum=A, nb_squares=n)</span>
<span class="sd">        ....:     print(&quot;%2d %d&quot;%(n, q.number_of()))</span>
<span class="sd">         3 1</span>
<span class="sd">         4 1</span>
<span class="sd">         5 2</span>
<span class="sd">         6 1</span>
<span class="sd">         7 2</span>
<span class="sd">         8 1</span>
<span class="sd">         9 2</span>
<span class="sd">        10 1</span>
<span class="sd">        11 2</span>
<span class="sd">        12 1</span>
<span class="sd">        13 2</span>
<span class="sd">        14 1</span>

<span class="sd">    To know all entries of the database look at `meth:cols`, `meth:info` or</span>
<span class="sd">    `meth:help`. The latter also provides a summary description of the columns.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dblocation</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">read_only</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">force_creation</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">old_version</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        INPUT:</span>

<span class="sd">        - ``dblocation`` - string - name of the database to use (optional).</span>

<span class="sd">        - ``read_only`` - bool (default: True) - if True, then the database is</span>
<span class="sd">          read_only and changes cannot be committed to disk.</span>

<span class="sd">        - ``force_creation`` - bool (default: False) - whether or not create the database.</span>

<span class="sd">        - ``old_version`` -- an integer</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">import</span> <span class="nn">os.path</span>
        <span class="kn">import</span> <span class="nn">surface_dynamics.flat_surfaces.origamis.origami_database</span> <span class="k">as</span> <span class="nn">odb</span>

        <span class="k">if</span> <span class="n">dblocation</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">dblocation</span> <span class="o">=</span> <span class="n">ORIGAMI_DB_LOCATION</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_old_version</span> <span class="o">=</span> <span class="n">old_version</span>
        <span class="k">if</span> <span class="n">old_version</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">False</span><span class="p">:</span>
            <span class="n">skeleton</span> <span class="o">=</span> <span class="n">OLDS</span><span class="p">[</span><span class="n">old_version</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">skeleton</span> <span class="o">=</span> <span class="n">ORIGAMI_DB_skeleton</span>

        <span class="k">if</span> <span class="n">force_creation</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">dblocation</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">read_only</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;read_only was set to True but no database exists at </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">dblocation</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">dblocation</span><span class="p">):</span>
                <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">dblocation</span><span class="p">)</span>
            <span class="n">SQLDatabase</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                    <span class="n">dblocation</span><span class="p">,</span>
                    <span class="n">read_only</span><span class="o">=</span><span class="n">read_only</span><span class="p">,</span>
                    <span class="n">skeleton</span><span class="o">=</span><span class="n">skeleton</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">SQLDatabase</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dblocation</span><span class="p">,</span> <span class="n">read_only</span><span class="o">=</span><span class="n">read_only</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">are_skeleton_equal</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_skeleton</span><span class="p">(),</span> <span class="n">skeleton</span><span class="p">):</span>
                <span class="n">k0</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_skeleton</span><span class="p">()[</span><span class="s1">&#39;origamis&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
                <span class="n">k1</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">skeleton</span><span class="p">[</span><span class="s1">&#39;origamis&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>

                <span class="n">k01</span> <span class="o">=</span> <span class="n">k0</span><span class="o">.</span><span class="n">difference</span><span class="p">(</span><span class="n">k1</span><span class="p">)</span>
                <span class="n">k10</span> <span class="o">=</span> <span class="n">k1</span><span class="o">.</span><span class="n">difference</span><span class="p">(</span><span class="n">k0</span><span class="p">)</span>

                <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

                <span class="k">if</span> <span class="n">k10</span><span class="p">:</span>
                    <span class="n">msg</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">column(s) </span><span class="si">{}</span><span class="s2"> appear(s) in the skeleton but not in the database&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">k10</span><span class="p">))</span>
                <span class="k">if</span> <span class="n">k01</span><span class="p">:</span>
                    <span class="n">msg</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">column(s) </span><span class="si">{}</span><span class="s2"> appear(s) in the database but not in the skeleton&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">k01</span><span class="p">))</span>

                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s1">&#39;Database at </span><span class="si">%s</span><span class="s1"> does not appear to be a valid origami database&#39;</span> <span class="o">%</span> <span class="n">dblocation</span> <span class="o">+</span> <span class="n">msg</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_data_to_entry</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_entry_to_data</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_format</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">kwd</span> <span class="ow">in</span> <span class="n">skeleton</span><span class="p">[</span><span class="s1">&#39;origamis&#39;</span><span class="p">]:</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">odb</span><span class="p">,</span> <span class="s1">&#39;data_to_&#39;</span> <span class="o">+</span> <span class="n">kwd</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_format</span><span class="p">[</span><span class="n">kwd</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data_to_entry</span><span class="p">[</span><span class="n">kwd</span><span class="p">]</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">odb</span><span class="p">,</span><span class="s1">&#39;data_to_&#39;</span> <span class="o">+</span> <span class="n">kwd</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">odb</span><span class="p">,</span> <span class="n">kwd</span> <span class="o">+</span> <span class="s1">&#39;_to_data&#39;</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_entry_to_data</span><span class="p">[</span><span class="n">kwd</span><span class="p">]</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">odb</span><span class="p">,</span><span class="n">kwd</span> <span class="o">+</span> <span class="s1">&#39;_to_data&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">odb</span><span class="p">,</span> <span class="s1">&#39;format_&#39;</span> <span class="o">+</span> <span class="n">kwd</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_format</span><span class="p">[</span><span class="n">kwd</span><span class="p">]</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">odb</span><span class="p">,</span> <span class="s1">&#39;format_&#39;</span> <span class="o">+</span> <span class="n">kwd</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_default_display</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;representative&#39;</span><span class="p">,</span> <span class="s1">&#39;stratum&#39;</span><span class="p">,</span> <span class="s1">&#39;component&#39;</span><span class="p">,</span> <span class="s1">&#39;veech_group_index&#39;</span><span class="p">]</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        String representation.</span>

<span class="sd">        TESTS::</span>

<span class="sd">            sage: from surface_dynamics import *</span>

<span class="sd">            sage: OrigamiDatabase().__repr__()</span>
<span class="sd">            &#39;Database of origamis&#39;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="s2">&quot;Database of origamis&quot;</span>

    <span class="k">def</span> <span class="fm">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns an iterator over all origami contained in that database.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">iter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">())</span>

    <span class="k">def</span> <span class="fm">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Number of entry in that database.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">()</span><span class="o">.</span><span class="n">number_of</span><span class="p">()</span>

<div class="viewcode-block" id="OrigamiDatabase.cols"><a class="viewcode-back" href="../../../../origamis.html#surface_dynamics.flat_surfaces.origamis.origami_database.OrigamiDatabase.cols">[docs]</a>    <span class="k">def</span> <span class="nf">cols</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the skeleton of self (which is the list of possible entries).</span>

<span class="sd">        EXAMPLES::</span>

<span class="sd">            sage: from surface_dynamics import *</span>

<span class="sd">            sage: O = OrigamiDatabase()</span>
<span class="sd">            sage: cols = O.cols()</span>
<span class="sd">            sage: &quot;representative&quot; in cols</span>
<span class="sd">            True</span>
<span class="sd">            sage: len(cols)</span>
<span class="sd">            45</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_old_version</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">False</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">OLDS</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_old_version</span><span class="p">][</span><span class="mi">1</span><span class="p">][:]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">ORIGAMI_DB_cols</span><span class="p">[:]</span></div>

<div class="viewcode-block" id="OrigamiDatabase.build"><a class="viewcode-back" href="../../../../origamis.html#surface_dynamics.flat_surfaces.origamis.origami_database.OrigamiDatabase.build">[docs]</a>    <span class="k">def</span> <span class="nf">build</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">comp</span><span class="p">,</span> <span class="n">N</span><span class="p">,</span> <span class="n">force_computation</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Update the database for the given component ``comp`` up to ``N`` squares.</span>

<span class="sd">        Note that in order to work the database should not be in read only mode.</span>

<span class="sd">        INPUT:</span>

<span class="sd">        - ``comp`` - stratum or component of stratum</span>

<span class="sd">        - ``N`` - integer</span>

<span class="sd">        - ``force_computation`` - force computation of data which may be yet in</span>
<span class="sd">          the database.</span>

<span class="sd">        - ``verbose`` - boolean - if ``True``, print useful interactive information</span>
<span class="sd">          during the process.</span>

<span class="sd">        EXAMPLES::</span>

<span class="sd">            sage: from surface_dynamics import *</span>

<span class="sd">            sage: import os</span>
<span class="sd">            sage: import tempfile</span>
<span class="sd">            sage: with tempfile.TemporaryDirectory() as tmpdir:</span>
<span class="sd">            ....:     db_name = os.path.join(tmpdir, &#39;my_db.db&#39;)</span>
<span class="sd">            ....:     D = OrigamiDatabase(db_name, read_only=False)</span>
<span class="sd">            ....:     D.build(AbelianStratum(4).odd_component(), 8)  # optional: gap_packages</span>
<span class="sd">            ....:     D.info()                                       # optional: gap_packages</span>
<span class="sd">            genus 2</span>
<span class="sd">            =======</span>
<span class="sd">            &lt;BLANKLINE&gt;</span>
<span class="sd">            genus 3</span>
<span class="sd">            =======</span>
<span class="sd">             H_3(4)^odd   :  8 T. curves (up to  7 squares)</span>
<span class="sd">            &lt;BLANKLINE&gt;</span>
<span class="sd">            &lt;BLANKLINE&gt;</span>
<span class="sd">             Total: 8 Teichmueller curves</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">__read_only__</span><span class="p">,</span> <span class="s2">&quot;The database should be not in read only&quot;</span>
        <span class="kn">import</span> <span class="nn">sys</span>
        <span class="kn">from</span> <span class="nn">time</span> <span class="kn">import</span> <span class="n">time</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_old_version</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">False</span><span class="p">:</span>
            <span class="n">columns</span> <span class="o">=</span> <span class="n">OLDS</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_old_version</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">columns</span> <span class="o">=</span> <span class="n">ORIGAMI_DB_cols</span>

        <span class="n">k</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># counter for the number of modifications</span>
        <span class="n">m</span> <span class="o">=</span> <span class="n">comp</span><span class="o">.</span><span class="n">stratum</span><span class="p">()</span><span class="o">.</span><span class="n">dimension</span><span class="p">()</span><span class="o">-</span><span class="mi">1</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">force_computation</span><span class="p">:</span>
            <span class="n">m</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">m</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">max_nb_squares</span><span class="p">(</span><span class="n">comp</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
            <span class="n">T0</span> <span class="o">=</span> <span class="n">time</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">N</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
                <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;nb_squares: </span><span class="si">%2d</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">%</span><span class="n">n</span><span class="p">)</span>
                <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;==============</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
                <span class="n">T1</span> <span class="o">=</span> <span class="n">time</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">comp</span><span class="o">.</span><span class="n">arithmetic_teichmueller_curves</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
                <span class="n">data</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="n">o</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">origami</span><span class="p">()</span>
                <span class="n">k</span> <span class="o">+=</span> <span class="mi">1</span>

                <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
                    <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;new entry r=</span><span class="si">%s</span><span class="s2"> u=</span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">o</span><span class="o">.</span><span class="n">r</span><span class="p">(),</span><span class="n">o</span><span class="o">.</span><span class="n">u</span><span class="p">()))</span>
                    <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot; build local data...&quot;</span><span class="p">)</span>
                    <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
                    <span class="n">t0</span> <span class="o">=</span> <span class="n">time</span><span class="p">()</span>
                <span class="n">data</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">build_local_data</span><span class="p">(</span><span class="n">o</span><span class="p">))</span>
                <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
                    <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;done in </span><span class="si">%s</span><span class="s2"> s</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">time</span><span class="p">()</span><span class="o">-</span><span class="n">t0</span><span class="p">))</span>
                    <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot; build lyapunov exponents...&quot;</span><span class="p">)</span>
                    <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
                    <span class="n">t1</span> <span class="o">=</span> <span class="n">time</span><span class="p">()</span>
                <span class="n">data</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">build_lyapunov_exponents</span><span class="p">(</span><span class="n">o</span><span class="p">))</span>
                <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
                    <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;done in </span><span class="si">%s</span><span class="s2"> s</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">time</span><span class="p">()</span><span class="o">-</span><span class="n">t1</span><span class="p">))</span>
                    <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot; build global data...&quot;</span><span class="p">)</span>
                    <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
                    <span class="n">t1</span> <span class="o">=</span> <span class="n">time</span><span class="p">()</span>
                <span class="n">data</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">build_global_data</span><span class="p">(</span><span class="n">o</span><span class="p">,</span><span class="n">c</span><span class="p">))</span>
                <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
                    <span class="n">t2</span> <span class="o">=</span> <span class="n">time</span><span class="p">()</span>
                    <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;done in </span><span class="si">%s</span><span class="s2"> s</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">t2</span><span class="o">-</span><span class="n">t1</span><span class="p">))</span>
                    <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot; total time: </span><span class="si">%s</span><span class="s2"> s</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">t2</span><span class="o">-</span><span class="n">t0</span><span class="p">))</span>

                <span class="n">q</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">((</span><span class="s1">&#39;representative&#39;</span><span class="p">,</span><span class="s1">&#39;=&#39;</span><span class="p">,</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;representative&#39;</span><span class="p">]))</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">q</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
                        <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;... the entry is yet in the database: update it.</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">delete_rows</span><span class="p">(</span><span class="n">q</span><span class="o">.</span><span class="n">sql_query</span><span class="p">())</span>

                <span class="c1"># check if there are missing columns</span>
                <span class="n">s1</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">ORIGAMI_DB_skeleton</span><span class="p">[</span><span class="s1">&#39;origamis&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
                <span class="n">s2</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>

                <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">s1</span><span class="o">.</span><span class="n">difference</span><span class="p">(</span><span class="n">s2</span><span class="p">):</span>
                        <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;WARNING: col </span><span class="si">%s</span><span class="s2"> does not appear in the request</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">%</span><span class="n">x</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">s2</span><span class="o">.</span><span class="n">difference</span><span class="p">(</span><span class="n">s1</span><span class="p">):</span>
                        <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;WARNING: col </span><span class="si">%s</span><span class="s2"> appear in the request and should not</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">%</span><span class="n">x</span><span class="p">)</span>

                <span class="c1"># convert data to fit the database format</span>
                <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data_to_entry</span><span class="p">:</span>
                        <span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_entry_to_data</span><span class="p">[</span><span class="n">key</span><span class="p">](</span><span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>

                <span class="n">value</span> <span class="o">=</span> <span class="p">[</span><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">e</span><span class="p">,</span><span class="kc">None</span><span class="p">)</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">columns</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">add_row</span><span class="p">(</span><span class="s1">&#39;origamis&#39;</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">columns</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
                    <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
                    <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>

            <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
                <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;TOTAL TIME: </span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">time</span><span class="p">()</span><span class="o">-</span><span class="n">T1</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%d</span><span class="s2"> Teichmueller curves added in </span><span class="si">%s</span><span class="s2">s</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="n">time</span><span class="p">()</span><span class="o">-</span><span class="n">T0</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span></div>

    <span class="k">def</span> <span class="nf">_update_from_old_versions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Update the database from an old one.</span>

<span class="sd">        As from time to time we might update the list of columns, this method is</span>
<span class="sd">        here to help the transition.</span>

<span class="sd">        INPUT:</span>

<span class="sd">        - ``other`` -- an OrigamiDatabase in an older version than ``self``</span>

<span class="sd">        - ``verbose`` -- if ``True`` print information about the missing columns</span>
<span class="sd">          in ``other`` and each column added</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">__read_only__</span><span class="p">,</span> <span class="s2">&quot;the database should not be in read only mode&quot;</span>

        <span class="kn">from</span> <span class="nn">sage.libs.gap.libgap</span> <span class="kn">import</span> <span class="n">libgap</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">OrigamiQuery</span><span class="p">):</span>
            <span class="n">old_db</span> <span class="o">=</span> <span class="n">other</span><span class="o">.</span><span class="n">database</span><span class="p">()</span>
            <span class="n">q</span> <span class="o">=</span> <span class="n">other</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">OrigamiDatabase</span><span class="p">):</span>
            <span class="n">old_db</span> <span class="o">=</span> <span class="n">other</span>
            <span class="n">q</span> <span class="o">=</span> <span class="n">other</span><span class="o">.</span><span class="n">query</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;other must be a query or a database&quot;</span><span class="p">)</span>

        <span class="n">old_cols</span> <span class="o">=</span> <span class="n">old_db</span><span class="o">.</span><span class="n">cols</span><span class="p">()</span>
        <span class="n">q</span><span class="o">.</span><span class="n">cols</span><span class="p">(</span><span class="n">old_cols</span><span class="p">)</span>
        <span class="n">new_cols</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cols</span><span class="p">())</span><span class="o">.</span><span class="n">difference</span><span class="p">(</span><span class="n">old_cols</span><span class="p">))</span>
        <span class="n">entry_order</span> <span class="o">=</span> <span class="n">old_cols</span> <span class="o">+</span> <span class="n">new_cols</span>

        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;new columns are: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">new_cols</span><span class="p">))</span>

        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">q</span><span class="o">.</span><span class="n">dict</span><span class="p">():</span>
            <span class="n">o</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;representative&#39;</span><span class="p">]</span>

            <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;update new entry:</span><span class="se">\n</span><span class="s2"> r=</span><span class="si">{}</span><span class="se">\n</span><span class="s2"> u=</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">o</span><span class="o">.</span><span class="n">r</span><span class="p">(),</span> <span class="n">o</span><span class="o">.</span><span class="n">u</span><span class="p">()))</span>

            <span class="k">if</span> <span class="s1">&#39;optimal_degree&#39;</span> <span class="ow">in</span> <span class="n">new_cols</span><span class="p">:</span>
                <span class="n">x</span><span class="p">[</span><span class="s1">&#39;optimal_degree&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">o</span><span class="o">.</span><span class="n">optimal_degree</span><span class="p">()</span>
            <span class="k">if</span> <span class="s1">&#39;quasi_primitive&#39;</span> <span class="ow">in</span> <span class="n">new_cols</span><span class="p">:</span>
                <span class="n">x</span><span class="p">[</span><span class="s1">&#39;quasi_primitive&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">o</span><span class="o">.</span><span class="n">is_quasi_primitive</span><span class="p">()</span>
            <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">col</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;relative_&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">new_cols</span><span class="p">):</span>
                <span class="n">primitive</span> <span class="o">=</span> <span class="n">o</span><span class="o">.</span><span class="n">is_primitive</span><span class="p">()</span>
                <span class="n">quasi_primitive</span> <span class="o">=</span> <span class="n">o</span><span class="o">.</span><span class="n">is_quasi_primitive</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">primitive</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">new_cols</span><span class="p">:</span>
                        <span class="n">x</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="n">col</span><span class="p">[</span><span class="mi">9</span><span class="p">:]]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="kn">from</span> <span class="nn">sage.functions.other</span> <span class="kn">import</span> <span class="n">factorial</span>

                    <span class="n">H</span> <span class="o">=</span> <span class="n">o</span><span class="o">.</span><span class="n">monodromy</span><span class="p">(</span><span class="n">relative</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                    <span class="n">x</span><span class="p">[</span><span class="s1">&#39;relative_monodromy_order&#39;</span><span class="p">]</span>     <span class="o">=</span> <span class="n">H</span><span class="o">.</span><span class="n">order</span><span class="p">()</span>
                    <span class="n">x</span><span class="p">[</span><span class="s1">&#39;relative_monodromy_index&#39;</span><span class="p">]</span>     <span class="o">=</span> <span class="n">factorial</span><span class="p">(</span><span class="n">o</span><span class="o">.</span><span class="n">optimal_degree</span><span class="p">())</span> <span class="o">/</span> <span class="n">H</span><span class="o">.</span><span class="n">order</span><span class="p">()</span>
                    <span class="n">x</span><span class="p">[</span><span class="s1">&#39;relative_monodromy_signature&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">any</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">sign</span><span class="p">()</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span> <span class="k">for</span> <span class="n">g</span> <span class="ow">in</span> <span class="n">H</span><span class="o">.</span><span class="n">gens</span><span class="p">())</span>
                    <span class="n">x</span><span class="p">[</span><span class="s1">&#39;relative_monodromy_solvable&#39;</span><span class="p">]</span>  <span class="o">=</span> <span class="n">H</span><span class="o">.</span><span class="n">is_solvable</span><span class="p">()</span>
                    <span class="n">x</span><span class="p">[</span><span class="s1">&#39;relative_monodromy_nilpotent&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">H</span><span class="o">.</span><span class="n">is_nilpotent</span><span class="p">()</span>
                    <span class="n">x</span><span class="p">[</span><span class="s1">&#39;relative_monodromy_gap_primitive_id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">libgap</span><span class="o">.</span><span class="n">PrimitiveIdentification</span><span class="p">(</span><span class="n">H</span><span class="p">)</span> <span class="k">if</span> <span class="n">H</span><span class="o">.</span><span class="n">order</span><span class="p">()</span> <span class="o">&lt;</span> <span class="mi">2500</span> <span class="ow">and</span> <span class="n">libgap</span><span class="o">.</span><span class="n">IsPrimitive</span><span class="p">(</span><span class="n">H</span><span class="p">)</span> <span class="k">else</span> <span class="kc">None</span>
                    <span class="n">x</span><span class="p">[</span><span class="s1">&#39;relative_monodromy_name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">libgap</span><span class="o">.</span><span class="n">StructureDescription</span><span class="p">(</span><span class="n">H</span><span class="p">)</span> <span class="k">if</span> <span class="n">quasi_primitive</span> <span class="k">else</span> <span class="kc">None</span>

            <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">x</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data_to_entry</span><span class="p">:</span>
                    <span class="n">x</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_entry_to_data</span><span class="p">[</span><span class="n">key</span><span class="p">](</span><span class="n">x</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>

            <span class="n">entry_order</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
            <span class="n">value</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="n">e</span><span class="p">]</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">entry_order</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add_row</span><span class="p">(</span><span class="s1">&#39;origamis&#39;</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">entry_order</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>

<div class="viewcode-block" id="OrigamiDatabase.update"><a class="viewcode-back" href="../../../../origamis.html#surface_dynamics.flat_surfaces.origamis.origami_database.OrigamiDatabase.update">[docs]</a>    <span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">,</span> <span class="n">replace</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Update the content of this database with the content of another one.</span>

<span class="sd">        INPUT:</span>

<span class="sd">        - ``other`` - a query, an origami database or a path to an origami</span>
<span class="sd">          database</span>

<span class="sd">        - ``replace`` - boolean - whether or not replace entries which are yet</span>
<span class="sd">          in the database.</span>

<span class="sd">        - ``verbose`` - boolean - if True, displays information during the</span>
<span class="sd">          transfer.</span>

<span class="sd">        EXAMPLES::</span>

<span class="sd">            sage: from surface_dynamics import *</span>

<span class="sd">            sage: import os</span>
<span class="sd">            sage: import tempfile</span>
<span class="sd">            sage: with tempfile.TemporaryDirectory() as tmpdir:</span>
<span class="sd">            ....:     db1_name = os.path.join(tmpdir, &#39;the_first_one.db&#39;)</span>
<span class="sd">            ....:     db2_name = os.path.join(tmpdir, &#39;the_second_one.db&#39;)</span>
<span class="sd">            ....:     D1 = OrigamiDatabase(db1_name, read_only=False)</span>
<span class="sd">            ....:     D2 = OrigamiDatabase(db2_name, read_only=False)</span>
<span class="sd">            ....:     D1.build(AbelianStratum(1,1).unique_component(), 7)  # optional: gap_packages</span>
<span class="sd">            ....:     D2.build(AbelianStratum(2).unique_component(), 5)    # optional: gap_packages</span>
<span class="sd">            ....:     D2.update(D1)                                        # optional: gap_packages</span>
<span class="sd">            ....:     D2.info()                                            # optional: gap_packages</span>
<span class="sd">            genus 2</span>
<span class="sd">            =======</span>
<span class="sd">             H_2(2)^hyp  :   2 T. curves (up to  4 squares)</span>
<span class="sd">             H_2(1^2)^hyp:   8 T. curves (up to  6 squares)</span>
<span class="sd">            &lt;BLANKLINE&gt;</span>
<span class="sd">            &lt;BLANKLINE&gt;</span>
<span class="sd">              Total: 10 Teichmueller curves</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">__read_only__</span><span class="p">,</span> <span class="s2">&quot;the database should not be in read only mode&quot;</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">OrigamiQuery</span><span class="p">):</span>
            <span class="n">q</span> <span class="o">=</span> <span class="n">other</span>
            <span class="n">q</span><span class="o">.</span><span class="n">cols</span><span class="p">(</span><span class="n">ORIGAMI_DB_cols</span><span class="p">)</span>
            <span class="n">q</span> <span class="o">=</span> <span class="n">q</span><span class="o">.</span><span class="n">sql_query</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">string_types</span><span class="p">):</span>
                <span class="n">other</span> <span class="o">=</span> <span class="n">OrigamiDatabase</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
            <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">OrigamiDatabase</span><span class="p">)</span>
            <span class="n">q</span> <span class="o">=</span> <span class="n">SQLQuery</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="s1">&#39;SELECT &#39;</span> <span class="o">+</span> <span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">ORIGAMI_DB_cols</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; FROM origamis&#39;</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">q</span><span class="o">.</span><span class="n">query_results</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;consider new entry </span><span class="si">%s</span><span class="s2">&quot;</span><span class="o">%</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">qq</span> <span class="o">=</span> <span class="n">SQLQuery</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;SELECT * FROM origamis WHERE representative=&#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span><span class="o">%</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">qq</span><span class="o">.</span><span class="n">query_results</span><span class="p">())</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;yet in database&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">replace</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">delete_rows</span><span class="p">(</span><span class="n">qq</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">add_row</span><span class="p">(</span><span class="s1">&#39;origamis&#39;</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">ORIGAMI_DB_cols</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span></div>

<div class="viewcode-block" id="OrigamiDatabase.rebuild"><a class="viewcode-back" href="../../../../origamis.html#surface_dynamics.flat_surfaces.origamis.origami_database.OrigamiDatabase.rebuild">[docs]</a>    <span class="k">def</span> <span class="nf">rebuild</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">q</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">local_data</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">lyapunov_exponents</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">global_data</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">nb_iterations</span><span class="o">=</span><span class="mh">0X1000</span><span class="p">,</span> <span class="n">nb_experiments</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
            <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Rebuild some of the data for the origami in the query ``q``.</span>

<span class="sd">        INPUT:</span>

<span class="sd">        - ``q`` - a query</span>

<span class="sd">        - ``local_data`` - boolean - whether or not we rebuild local data.</span>

<span class="sd">        - ``lyapunov_exponents`` - boolean - whether or not rebuild lyapunov</span>
<span class="sd">          exponents approximation (time consuming).</span>

<span class="sd">        - ``global_data`` - boolean - whether or not rebuild global data (time</span>
<span class="sd">          and memory consuming).</span>

<span class="sd">        - ``nb_experiments``, ``nb_iterations`` - integers - option for the</span>
<span class="sd">          computation of Lyapunov exponents.</span>

<span class="sd">        - ``verbose`` - boolean - if True displays nice information in real</span>
<span class="sd">          time.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">__read_only__</span><span class="p">,</span> <span class="s2">&quot;the database should not be in read only mode&quot;</span>
        <span class="k">if</span> <span class="n">q</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">q</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="n">OrigamiQuery</span><span class="p">)</span> <span class="ow">and</span> <span class="n">q</span><span class="o">.</span><span class="n">database</span><span class="p">()</span> <span class="o">==</span> <span class="bp">self</span>
        <span class="n">q</span><span class="o">.</span><span class="n">cols</span><span class="p">(</span><span class="s1">&#39;*&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">q</span><span class="o">.</span><span class="n">dict</span><span class="p">():</span>
            <span class="n">o</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;representative&#39;</span><span class="p">]</span>
            <span class="n">qq</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">((</span><span class="s1">&#39;representative&#39;</span><span class="p">,</span><span class="s1">&#39;=&#39;</span><span class="p">,</span><span class="n">o</span><span class="p">))</span>
            <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">qq</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;there is a problem!&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">delete_rows</span><span class="p">(</span><span class="n">qq</span><span class="o">.</span><span class="n">sql_query</span><span class="p">())</span>

            <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;modify r=</span><span class="si">%s</span><span class="s2"> u=</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">o</span><span class="o">.</span><span class="n">r</span><span class="p">(),</span> <span class="n">o</span><span class="o">.</span><span class="n">u</span><span class="p">()))</span>

            <span class="k">if</span> <span class="n">local_data</span><span class="p">:</span>
                <span class="n">x</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">build_local_data</span><span class="p">(</span><span class="n">o</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">lyapunov_exponents</span><span class="p">:</span>
                <span class="n">x</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">build_lyapunov_exponents</span><span class="p">(</span><span class="n">o</span><span class="p">,</span>
                    <span class="n">nb_iterations</span><span class="o">=</span><span class="n">nb_iterations</span><span class="p">,</span>
                    <span class="n">nb_experiments</span><span class="o">=</span><span class="n">nb_experiments</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">global_data</span><span class="p">:</span>
                <span class="n">x</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">build_global_data</span><span class="p">(</span><span class="n">o</span><span class="p">))</span>

            <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">x</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data_to_entry</span><span class="p">:</span>
                    <span class="n">x</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_entry_to_data</span><span class="p">[</span><span class="n">key</span><span class="p">](</span><span class="n">x</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>

            <span class="n">entry_order</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
            <span class="n">value</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="n">e</span><span class="p">]</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">entry_order</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add_row</span><span class="p">(</span><span class="s1">&#39;origamis&#39;</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">entry_order</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span></div>

<span class="c1">#    def strata(self, **kwds):</span>
<span class="c1">#        r&quot;&quot;&quot;</span>
<span class="c1">#        Return the list of strata for which some orbit are computed.</span>
<span class="c1">#</span>
<span class="c1">#        For precisions, see `meth:components` and `meth:info`.</span>
<span class="c1">#</span>
<span class="c1">#        INPUT:</span>
<span class="c1">#</span>
<span class="c1">#        - ``genus`` (optional)</span>
<span class="c1">#</span>
<span class="c1">#        - ``dimension`` (optional)</span>
<span class="c1">#</span>
<span class="c1">#        EXAMPLES::</span>
<span class="c1">#</span>
<span class="c1">#            sage: O = OrigamiDatabase()</span>
<span class="c1">#            sage: O.strata(genus=3)</span>
<span class="c1">#            [H_3(4), H_3(2^2), H_3(3, 1), H_3(2, 1^2), H_3(1^4)]</span>
<span class="c1">#        &quot;&quot;&quot;</span>
<span class="c1">#        q = tuple((x,&quot;=&quot;,kwds[x]) for x in kwds)</span>
<span class="c1">#        return sorted(set(self.query(*q,cols=&#39;stratum&#39;)))</span>
<span class="c1">#</span>
<span class="c1">#    def components(self):</span>
<span class="c1">#        r&quot;&quot;&quot;</span>
<span class="c1">#        Return the list of components for which some orbit are computed.</span>
<span class="c1">#</span>
<span class="c1">#        For more precisions, see `meth:info`.</span>
<span class="c1">#</span>
<span class="c1">#        EXAMPLES::</span>
<span class="c1">#</span>
<span class="c1">#            sage: O = OrigamiDatabase()</span>
<span class="c1">#            sage: O.components()</span>
<span class="c1">#            []</span>
<span class="c1">#        &quot;&quot;&quot;</span>
<span class="c1">#        q = self.query()</span>
<span class="c1">#        q.cols((&quot;stratum&quot;,&quot;component&quot;))</span>
<span class="c1">#        return sorted(cc_from_name[x[1]](x[0]) for x in set(map(tuple,q)))</span>

<div class="viewcode-block" id="OrigamiDatabase.info"><a class="viewcode-back" href="../../../../origamis.html#surface_dynamics.flat_surfaces.origamis.origami_database.OrigamiDatabase.info">[docs]</a>    <span class="k">def</span> <span class="nf">info</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">genus</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">dimension</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">print_all</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Print the list of connected components and the number of squares up to</span>
<span class="sd">        which the database is filled.</span>

<span class="sd">        INPUT:</span>

<span class="sd">        - ``genus`` - integer (default: None) - if not None, print only info for</span>
<span class="sd">          that genus.</span>

<span class="sd">        - ``dimension`` - Integer (default: None) - if not None, print only info</span>
<span class="sd">          for that dimension.</span>

<span class="sd">        - ``print_all`` - boolean (default: False) - print also the components</span>
<span class="sd">          for which nothing has been computed yet.</span>

<span class="sd">        EXAMPLES::</span>

<span class="sd">            sage: from surface_dynamics import *</span>

<span class="sd">            sage: O = OrigamiDatabase()</span>
<span class="sd">            sage: O.info()</span>
<span class="sd">            genus 2</span>
<span class="sd">            =======</span>
<span class="sd">            ...</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">surface_dynamics.flat_surfaces.abelian_strata</span> <span class="kn">import</span> <span class="n">AbelianStrata</span>

        <span class="k">if</span> <span class="n">genus</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">q</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">cols</span><span class="o">=</span><span class="s1">&#39;genus&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">q</span><span class="o">.</span><span class="n">number_of</span><span class="p">():</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Empty database&quot;</span><span class="p">)</span>
                <span class="k">return</span>
            <span class="n">genera</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="nb">max</span><span class="p">(</span><span class="n">q</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">genus</span><span class="p">,(</span><span class="nb">int</span><span class="p">,</span><span class="n">Integer</span><span class="p">)):</span>
            <span class="n">genera</span> <span class="o">=</span> <span class="p">[</span><span class="n">genus</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span>

        <span class="n">m</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">cc</span><span class="p">))</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">AbelianStrata</span><span class="p">(</span><span class="n">genus</span><span class="o">=</span><span class="n">genera</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="k">for</span> <span class="n">cc</span> <span class="ow">in</span> <span class="n">a</span><span class="o">.</span><span class="n">components</span><span class="p">())</span>
        <span class="n">s</span> <span class="o">=</span> <span class="s1">&#39; {0!s:</span><span class="si">%s</span><span class="s1">}: </span><span class="si">{1!s:&gt;3}</span><span class="s1"> T. curves (up to </span><span class="si">{2!s:&gt;2}</span><span class="s1"> squares)&#39;</span><span class="o">%</span><span class="n">m</span>

        <span class="n">n_total</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">g</span> <span class="ow">in</span> <span class="n">genera</span><span class="p">:</span>
            <span class="n">AA</span> <span class="o">=</span> <span class="n">AbelianStrata</span><span class="p">(</span><span class="n">genus</span><span class="o">=</span><span class="n">g</span><span class="p">,</span><span class="n">dimension</span><span class="o">=</span><span class="n">dimension</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">AA</span><span class="o">.</span><span class="n">cardinality</span><span class="p">():</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;genus </span><span class="si">%d</span><span class="s2">&quot;</span><span class="o">%</span><span class="n">g</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=======&quot;</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">A</span> <span class="ow">in</span> <span class="n">AA</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">CC</span> <span class="ow">in</span> <span class="n">A</span><span class="o">.</span><span class="n">components</span><span class="p">():</span>
                        <span class="n">n</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">((</span><span class="s2">&quot;stratum&quot;</span><span class="p">,</span><span class="s2">&quot;=&quot;</span><span class="p">,</span><span class="n">A</span><span class="p">),(</span><span class="s2">&quot;component&quot;</span><span class="p">,</span><span class="s2">&quot;=&quot;</span><span class="p">,</span><span class="n">CC</span><span class="o">.</span><span class="n">_name</span><span class="p">))</span><span class="o">.</span><span class="n">number_of</span><span class="p">()</span>
                        <span class="k">if</span> <span class="n">n</span> <span class="ow">or</span> <span class="n">print_all</span><span class="p">:</span>
                            <span class="nb">print</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">CC</span><span class="p">,</span><span class="n">n</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">max_nb_squares</span><span class="p">(</span><span class="n">CC</span><span class="p">)))</span>
                            <span class="n">n_total</span> <span class="o">+=</span> <span class="n">n</span>
                <span class="nb">print</span><span class="p">()</span>
        <span class="nb">print</span><span class="p">()</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Total: </span><span class="si">%d</span><span class="s2"> Teichmueller curves&quot;</span><span class="o">%</span><span class="n">n_total</span><span class="p">)</span></div>

<div class="viewcode-block" id="OrigamiDatabase.help"><a class="viewcode-back" href="../../../../origamis.html#surface_dynamics.flat_surfaces.origamis.origami_database.OrigamiDatabase.help">[docs]</a>    <span class="k">def</span> <span class="nf">help</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cols</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Print some help relative to the columns of the database.</span>

<span class="sd">        If ``cols`` is provided then gives help only for these columns.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span></div>

<div class="viewcode-block" id="OrigamiDatabase.max_nb_squares"><a class="viewcode-back" href="../../../../origamis.html#surface_dynamics.flat_surfaces.origamis.origami_database.OrigamiDatabase.max_nb_squares">[docs]</a>    <span class="k">def</span> <span class="nf">max_nb_squares</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">comp</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the maximum number of squares for which Teichmueller curves have</span>
<span class="sd">        been computed.</span>

<span class="sd">        If ``comp`` is None (default), then returns the biggest integer for</span>
<span class="sd">        which the database contains all data up to that integer. If ``comp`` is</span>
<span class="sd">        a stratum or a component of stratum, then returns the maximum number of</span>
<span class="sd">        squares computed for that stratum.</span>

<span class="sd">        EXAMPLES::</span>

<span class="sd">            sage: from surface_dynamics import *</span>

<span class="sd">            sage: O = OrigamiDatabase()</span>
<span class="sd">            sage: O.max_nb_squares(AbelianStratum(2))</span>
<span class="sd">            139</span>
<span class="sd">            sage: O.max_nb_squares()</span>
<span class="sd">            11</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">surface_dynamics.flat_surfaces.abelian_strata</span> <span class="kn">import</span> \
        <span class="n">AbelianStratum</span><span class="p">,</span>  <span class="n">AbelianStratumComponent</span><span class="p">,</span> <span class="n">AbelianStrata</span>

        <span class="k">if</span> <span class="n">comp</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">m</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_nb_squares</span><span class="p">(</span><span class="n">AbelianStratum</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>
            <span class="n">d</span> <span class="o">=</span> <span class="mi">5</span>
            <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
                <span class="c1"># at each step we test strata of dimension d and we have m &gt;= d-1</span>
                <span class="c1"># if we do have equality at the end of the loop, we can not go</span>
                <span class="c1"># further</span>
                <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">AbelianStrata</span><span class="p">(</span><span class="n">dimension</span><span class="o">=</span><span class="n">d</span><span class="p">):</span>
                    <span class="n">k</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_nb_squares</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">k</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>  <span class="c1"># we miss an origami with d-1 squares</span>
                        <span class="k">return</span> <span class="n">d</span><span class="o">-</span><span class="mi">2</span>
                    <span class="k">else</span><span class="p">:</span>      <span class="c1"># we can update m</span>
                        <span class="n">m</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">m</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">m</span> <span class="o">==</span> <span class="n">d</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">m</span>
                <span class="n">d</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">comp</span><span class="p">,</span> <span class="n">AbelianStratum</span><span class="p">):</span>
            <span class="k">return</span> <span class="nb">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">max_nb_squares</span><span class="p">(</span><span class="n">comp</span><span class="p">)</span> <span class="k">for</span> <span class="n">comp</span> <span class="ow">in</span> <span class="n">comp</span><span class="o">.</span><span class="n">components</span><span class="p">())</span>

        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">comp</span><span class="p">,</span> <span class="n">AbelianStratumComponent</span><span class="p">):</span>
            <span class="n">stratum</span> <span class="o">=</span> <span class="n">comp</span><span class="o">.</span><span class="n">stratum</span><span class="p">()</span>
            <span class="n">comp</span> <span class="o">=</span> <span class="n">comp</span><span class="o">.</span><span class="n">_name</span>
            <span class="n">query</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">((</span><span class="s1">&#39;stratum&#39;</span><span class="p">,</span><span class="s1">&#39;=&#39;</span><span class="p">,</span><span class="n">stratum</span><span class="p">),(</span><span class="s1">&#39;component&#39;</span><span class="p">,</span><span class="s1">&#39;=&#39;</span><span class="p">,</span><span class="n">comp</span><span class="p">))</span>
            <span class="n">query</span><span class="o">.</span><span class="n">cols</span><span class="p">(</span><span class="s1">&#39;nb_squares&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">query</span><span class="o">.</span><span class="n">number_of</span><span class="p">()</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">return</span> <span class="mi">0</span>
            <span class="k">return</span> <span class="nb">max</span><span class="p">(</span><span class="n">query</span><span class="o">.</span><span class="n">list</span><span class="p">())</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\&quot;</span><span class="s2">comp</span><span class="se">\&quot;</span><span class="s2"> should be None, a stratum of Abelian differential or a component of stratum&quot;</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">_get_format</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cols</span><span class="p">):</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the dictionary of functions for formatting the given the list</span>
<span class="sd">        ``cols`` of columns to display.</span>

<span class="sd">        EXAMPLES::</span>

<span class="sd">            sage: from surface_dynamics import *</span>

<span class="sd">            sage: OrigamiDatabase()._get_format([&#39;representative&#39;, &#39;stratum&#39;])</span>
<span class="sd">            {&#39;representative&#39;: &lt;function format_representative at ...&gt;,</span>
<span class="sd">             &#39;stratum&#39;: &lt;function data_to_stratum at ...&gt;}</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">format_cols</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">cols</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_format</span><span class="p">:</span>
                <span class="n">format_cols</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_format</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">format_cols</span>

<div class="viewcode-block" id="OrigamiDatabase.query"><a class="viewcode-back" href="../../../../origamis.html#surface_dynamics.flat_surfaces.origamis.origami_database.OrigamiDatabase.query">[docs]</a>    <span class="k">def</span> <span class="nf">query</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">query_list</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">):</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        From a list of restriction, returns a list of possible entry in the</span>
<span class="sd">        database. By default, returns only the found origamis.</span>

<span class="sd">        Where to find the possible entries self.cols() then a sign among &#39;=&#39;</span>
<span class="sd">        (equality), &#39;&lt;&gt;&#39; (difference), &#39;&lt;&#39;, &#39;&gt;&#39;, &#39;&lt;=&#39;, &#39;&gt;=&#39; (comparisons).</span>

<span class="sd">        EXAMPLES::</span>

<span class="sd">            sage: from surface_dynamics import *</span>

<span class="sd">            sage: D = OrigamiDatabase()</span>
<span class="sd">            sage: for o in D.query(stratum=AbelianStratum(1,1), nb_squares=6):</span>
<span class="sd">            ....:     print(&quot;%s\n---------------&quot; % o)</span>
<span class="sd">            (1)(2)(3,4,5,6)</span>
<span class="sd">            (1,2,3)(4,5,6)</span>
<span class="sd">            ---------------</span>
<span class="sd">            (1)(2)(3)(4,5,6)</span>
<span class="sd">            (1,2,3,4)(5,6)</span>
<span class="sd">            ---------------</span>
<span class="sd">            (1)(2)(3,4)(5)(6)</span>
<span class="sd">            (1,2,3)(4,5,6)</span>
<span class="sd">            ---------------</span>
<span class="sd">            (1)(2)(3)(4,5)(6)</span>
<span class="sd">            (1,2,3,4)(5,6)</span>
<span class="sd">            ---------------</span>
<span class="sd">            (1)(2,3)(4,5)(6)</span>
<span class="sd">            (1,2,4)(3,5,6)</span>
<span class="sd">            ---------------</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_old_version</span><span class="p">:</span>
            <span class="n">skeleton</span><span class="p">,</span><span class="n">columns</span> <span class="o">=</span> <span class="n">OLDS</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_old_version</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">skeleton</span> <span class="o">=</span> <span class="n">ORIGAMI_DB_skeleton</span>
            <span class="n">columns</span> <span class="o">=</span> <span class="n">ORIGAMI_DB_cols</span>

        <span class="k">if</span> <span class="s1">&#39;cols&#39;</span> <span class="ow">in</span> <span class="n">kwds</span><span class="p">:</span>
            <span class="n">cols</span> <span class="o">=</span> <span class="n">kwds</span><span class="p">[</span><span class="s1">&#39;cols&#39;</span><span class="p">]</span>
            <span class="k">del</span> <span class="n">kwds</span><span class="p">[</span><span class="s1">&#39;cols&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">cols</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;representative&#39;</span><span class="p">]</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">cols</span><span class="p">,</span> <span class="n">string_types</span><span class="p">):</span>
            <span class="n">cols</span> <span class="o">=</span> <span class="p">[</span><span class="n">cols</span><span class="p">]</span>

        <span class="n">query_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">query_list</span><span class="p">)</span>
        <span class="n">query_list</span><span class="o">.</span><span class="n">extend</span><span class="p">((</span><span class="n">entry</span><span class="p">,</span><span class="s1">&#39;=&#39;</span><span class="p">,</span><span class="n">value</span><span class="p">)</span> <span class="k">for</span> <span class="n">entry</span><span class="p">,</span><span class="n">value</span> <span class="ow">in</span> <span class="n">iteritems</span><span class="p">(</span><span class="n">kwds</span><span class="p">))</span>

        <span class="n">qq</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">entry</span><span class="p">,</span><span class="n">sign</span><span class="p">,</span><span class="n">value</span> <span class="ow">in</span> <span class="n">query_list</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">entry</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">columns</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> is not a valid column name&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">entry</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">entry</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_entry_to_data</span><span class="p">:</span>
                <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_entry_to_data</span><span class="p">[</span><span class="n">entry</span><span class="p">](</span><span class="n">value</span><span class="p">)</span>
            <span class="n">typ</span> <span class="o">=</span> <span class="n">skeleton</span><span class="p">[</span><span class="s1">&#39;origamis&#39;</span><span class="p">][</span><span class="n">entry</span><span class="p">][</span><span class="s1">&#39;sql&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">typ</span> <span class="o">==</span> <span class="s1">&#39;TEXT&#39;</span><span class="p">:</span>
                <span class="n">qq</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s%s</span><span class="s2">&#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">entry</span><span class="p">,</span> <span class="n">sign</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">)))</span>
            <span class="k">elif</span> <span class="n">typ</span> <span class="o">==</span> <span class="s1">&#39;BOOLEAN&#39;</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">value</span><span class="p">:</span>
                    <span class="n">qq</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s%s</span><span class="s2">&#39;True&#39;&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">entry</span><span class="p">,</span><span class="n">sign</span><span class="p">))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">qq</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s%s</span><span class="s2">&#39;False&#39;&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">entry</span><span class="p">,</span><span class="n">sign</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">qq</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s%s%s</span><span class="s2">&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">entry</span><span class="p">,</span><span class="n">sign</span><span class="p">,</span><span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">)))</span>

        <span class="k">if</span> <span class="n">qq</span><span class="p">:</span>
            <span class="n">query_string</span> <span class="o">=</span> <span class="s1">&#39; AND &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">qq</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">query_string</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>

        <span class="k">return</span> <span class="n">OrigamiQuery</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">query_string</span><span class="o">=</span><span class="n">query_string</span><span class="p">,</span>
            <span class="n">cols</span><span class="o">=</span><span class="n">cols</span><span class="p">,</span>
            <span class="n">format_cols</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_format</span><span class="p">(</span><span class="n">cols</span><span class="p">))</span></div></div>
</pre></div>
        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          
          
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 2021-2023, the surface-dynamics authors
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer no-toc">
      
      
      
    </aside>
  </div>
</div><script data-url_root="../../../../" id="documentation_options" src="../../../../_static/documentation_options.js"></script>
    <script src="../../../../_static/jquery.js"></script>
    <script src="../../../../_static/underscore.js"></script>
    <script src="../../../../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../../../../_static/doctools.js"></script>
    <script src="../../../../_static/sphinx_highlight.js"></script>
    <script src="../../../../_static/scripts/furo.js"></script>
    </body>
</html>